(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,533568,416872,512122,680126,689280,e=>{"use strict";e.s(["default",()=>aY],533568);var t=e.i(156820),a=e.i(76756),s=e.i(700585),i=e.i(315366),n=e.i(850821),r=e.i(246429),o=e.i(637797),l=e.i(72290),c=e.i(497985);e.i(685846);var d=e.i(376098),u=e.i(90476),m=e.i(12465),p=e.i(510965);let g=(0,p.default)("FlipHorizontal",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h3",key:"1i73f7"}],["path",{d:"M16 3h3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-3",key:"saxlbk"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 14v2",key:"8jcxud"}],["path",{d:"M12 8v2",key:"1woqiv"}],["path",{d:"M12 2v2",key:"tus03m"}]]);var h=e.i(763578),x=e.i(889963),f=e.i(122088),v=e.i(969736),y=e.i(486492),b=e.i(179314),j=e.i(623434),S=e.i(598371);e.i(968648);var w=e.i(873329),I=e.i(723008);let k=e=>{let{hasImage:a,prompt:s,onParentPeek:i,focusedImageUrl:n,parentImageUrl:o,isStreaming:l,onRegenerate:p,onClose:k}=e,{t:C}=(0,w.useTranslation)("base"),[N,M]=(0,S.useState)(!1),[E,T]=(0,S.useState)(void 0),[P,_]=(0,S.useState)(!1),D=(0,f.useMobileUa)(),A=(0,r.useChatPageStore)(e=>e.conversationId),L=(0,r.useChatPageStore)(e=>e.lastMessageId),{editImagePresets:z}=(0,x.useEditImagePresets)(),R=(0,S.useMemo)(()=>{if(!E)return;let e=z.flatMap(e=>e.presets).find(e=>e.prompt===E);return e?(0,t.jsxs)(t.Fragment,{children:[e.icon&&S.default.createElement(e.icon,{size:20,className:"text-secondary flex-shrink-0"}),(0,t.jsx)("h1",{className:"text-lg font-semibold truncate",children:e.label})]}):(0,t.jsx)("h1",{className:"text-lg font-semibold truncate",children:E})},[E,z]),O=(0,S.useCallback)(()=>{!P&&n&&(_(!0),(0,v.downloadImage)(n,null==n?void 0:n.split("/").pop()).catch((0,y.createLogError)("image-editor:handleDownload")).finally(()=>_(!1)))},[n,P]);return(0,S.useEffect)(()=>{s&&E!==s&&T(s)},[s,E]),(0,S.useEffect)(()=>{o&&!N&&M(!0)},[o,N]),(0,t.jsx)("header",{className:"flex justify-between w-full items-center min-h-10 gap-3  relative z-30 flex-shrink-0",children:(0,t.jsxs)(b.AnimatePresence,{mode:"popLayout",children:[E&&(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},className:"flex items-center gap-2 w-full overflow-hidden min-w-0",children:R},E),(0,t.jsxs)("div",{className:"flex gap-2 ms-auto shrink-0",children:[(0,t.jsxs)(t.Fragment,{children:[N&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,t.jsx)(h.ButtonWithTooltip,{size:"iconMd",variant:"ghost",rounded:!0,"aria-label":C("Compare","Compare"),tooltipContent:C("Compare","Compare"),tooltipContentProps:{side:"bottom"},onMouseDown:()=>i(!0),onMouseUp:()=>i(!1),onMouseLeave:()=>i(!1),onTouchStart:e=>{e.preventDefault(),e.stopPropagation(),i(!0)},onTouchEnd:e=>{e.preventDefault(),e.stopPropagation(),i(!1)},onContextMenu:e=>{e.preventDefault(),e.stopPropagation()},onContextMenuCapture:e=>{e.preventDefault(),e.stopPropagation()},asChild:!0,disabled:l||!o,children:(0,t.jsx)(j.motion.button,{whileTap:!l&&o?{scale:.9}:void 0,children:(0,t.jsx)(g,{className:"size-5"})})})},"compare"),(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,t.jsx)(h.ButtonWithTooltip,{size:"iconMd",variant:"ghost",rounded:!0,"aria-label":C("Regenerate","Regenerate"),tooltipContent:C("Regenerate","Regenerate"),tooltipContentProps:{side:"bottom"},asChild:!0,disabled:l||!o,onClick:p,children:(0,t.jsx)(j.motion.button,{whileTap:!l&&o?{scale:.9}:void 0,children:(0,t.jsx)(u.RefreshCwIcon,{className:"size-5"})})})},"regenerate")]}),a&&(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,t.jsx)(h.ButtonWithTooltip,{variant:"ghost",size:"iconMd",rounded:!0,"aria-label":C("Download Image","Download Image"),tooltipContent:C("Download Image","Download Image"),tooltipContentProps:{side:"bottom"},disabled:l||!n||P,onClick:O,children:P?(0,t.jsx)(I.Spinner,{size:"xs"}):(0,t.jsx)(d.DownloadIcon,{className:"size-5"})})},"download"),A&&L&&(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,t.jsx)(c.ShareButton,{variant:"ghost",size:"iconMd",rounded:!0,conversationId:A,responseId:L,iconProps:{size:20}})},"share")]}),D?(0,t.jsx)(h.Button,{"aria-label":C("Close Image Editor","Close Image Editor"),variant:"filled",size:"iconMd",rounded:!0,onClick:k,children:(0,t.jsx)(m.XIcon,{size:20})}):(0,t.jsx)(h.ButtonWithTooltip,{"aria-label":C("Close Image Editor","Close Image Editor"),tooltipContent:C("Close Image Editor","Close Image Editor"),tooltipContentProps:{side:"bottom"},variant:"filled",size:"md",rounded:!0,onClick:k,children:C("Close","Close")})]})]})})};var C=e.i(448888),N=e.i(211959);let M=e=>{let{images:a,focusedOption:s,isStreaming:i,onSelect:n}=e;return(0,t.jsx)(j.motion.aside,{className:"lg:fixed top-0 inset-0 lg:top-0 lg:right-0 lg:left-auto flex lg:flex-col items-center justify-center lg:h-full gap-4 pb-3 lg:p-6 pointer-events-none z-30",variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",children:(0,t.jsx)(b.AnimatePresence,{mode:"popLayout",children:a.map((e,a)=>(0,t.jsx)(j.motion.button,{className:(0,N.cn)("size-16 sm:size-20 relative rounded-xl border bg-background p-1 pointer-events-auto",{"ring-primary ring-2":a===s}),onClick:()=>n(a),whileTap:a!==s?{scale:.95}:{},variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",children:(0,t.jsx)("div",{className:"relative h-full w-full overflow-hidden rounded-lg",children:(0,t.jsx)("figure",{className:"absolute -translate-x-1/2 left-1/2 h-full aspect-[4/3]",children:(0,t.jsx)(C.GrokImage,{isModerated:e.isModerated,status:i?"streaming":"finished",iconSize:24,intermediateResults:i?e.progressMap:[{progress:1,imageUrl:e.url}]})})})},e.id))})},"image-editor-option-nav")};var E=e.i(310158),T=e.i(383274),P=e.i(50636),_=e.i(592766),D=e.i(511765),A=e.i(920958),L=e.i(259473),z=e.i(688578),R=e.i(536459),O=e.i(159422),B=e.i(470753),U=e.i(633918),F=e.i(221045),H=e.i(715127);let G=e=>{let{isEditingCurrentImage:a,setIsPeekingParent:s,isPeekingParent:i,focusedImage:n,parentImageUrl:r,generatedImageHeight:o,generatedImageWidth:l,isFinalImageLoaded:c,setIsFinalImageLoaded:d,isParentImageLoaded:u,setIsParentImageLoaded:m}=e,[p,g]=(0,S.useState)([]),[h,x]=(0,S.useState)(!1),[f,v]=(0,S.useState)(!1),[y,w]=(0,S.useState)(!0),I=(0,S.useMemo)(()=>!!(o&&l),[o,l]),k=(0,S.useMemo)(()=>o&&l?l/o:4/3,[o,l]);return(0,S.useEffect)(()=>{(a||!y)&&(null==n?void 0:n.progressMap)?g(n.progressMap):!a&&(null==n?void 0:n.url)?g(e=>[...e,{progress:1,imageUrl:n.url||""}]):g([])},[a,null==n?void 0:n.url,null==n?void 0:n.progressMap,y]),(0,S.useEffect)(()=>{if(!h)return void s(!1);let e=setTimeout(()=>{h&&!f&&s(!0)},100);return()=>clearTimeout(e)},[h,f,s]),(0,S.useEffect)(()=>{a&&y&&w(!1),a||!c||y||w(!0)},[a,c,y]),(0,t.jsx)("figure",{className:(0,N.cn)("relative group/image w-full max-w-5xl 2xl:max-w-6xl overflow-hidden rounded-lg select-none",!a&&r&&(i?"cursor-grabbing":"cursor-grab")),onDragStart:e=>{if(i)return void e.preventDefault();v(!0)},onDragEnd:()=>{v(!1),x(!1)},onMouseDown:e=>{0===e.button&&x(!0)},onMouseUp:()=>x(!1),onTouchStart:e=>{e.preventDefault(),e.stopPropagation(),x(!0)},onTouchEnd:e=>{e.preventDefault(),x(!1)},onMouseLeave:()=>{x(!1),v(!1)},children:(0,t.jsx)(b.AnimatePresence,{mode:"wait",children:a||!y?I?(0,t.jsx)(j.motion.div,{initial:{opacity:0,filter:"blur(4px)"},animate:{opacity:1,filter:"blur(0px)"},exit:{opacity:1,filter:"blur(0px)",transition:{delay:1.5}},transition:{ease:"easeInOut"},className:"h-full mx-auto",style:{aspectRatio:k,maxHeight:o},children:(0,t.jsx)(C.GrokImage,{status:"streaming",intermediateResults:p,isModerated:null==n?void 0:n.isModerated,aspectRatio:k})},"streaming-image"):(0,t.jsx)(q,{}):(0,t.jsxs)("div",{className:"flex relative items-center justify-center w-full h-full",children:[(null==n?void 0:n.url)&&(0,t.jsxs)(t.Fragment,{children:[!c&&(0,t.jsx)(q,{className:"absolute z-20 inset-0"}),(0,t.jsx)(j.motion.img,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},exit:"hidden",animate:r&&i||!c?"hidden":"visible",transition:{ease:"easeInOut"},src:n.url,alt:"active-image",className:"max-h-full aspect-auto rounded-lg",onLoad:()=>d(!0)},"finished-image")]}),(0,t.jsx)(b.AnimatePresence,{children:!a&&r&&i&&(0,t.jsxs)(j.motion.div,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},initial:"hidden",exit:"hidden",animate:"visible",transition:{ease:"easeInOut"},className:"absolute z-10 w-full h-full flex items-center overflow-hidden",children:[!u&&(0,t.jsx)(q,{className:"absolute z-20 inset-0"}),(0,t.jsx)(j.motion.img,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},animate:u?"visible":"hidden",src:r,alt:"parent-image",className:"max-h-full aspect-auto mx-auto rounded-lg",onLoad:()=>m(!0)},"parent-image")]},"parent-image-container")})]})})})},q=e=>{let{className:a}=e;return(0,t.jsx)(j.motion.div,{initial:{opacity:0,filter:"blur(4px)"},animate:{opacity:1,filter:"blur(0px)"},transition:{ease:"easeInOut"},className:(0,N.cn)("h-full w-full flex items-center justify-center animate-pulse-lg",a),children:(0,t.jsx)(H.ImageIcon,{size:60,strokeWidth:1.3,className:"opacity-30 rotate-[-10deg]"})},"loader")};var W=e.i(328788),V=e.i(332484),Y=e.i(165415),K=e.i(431533),Q=e.i(659065),X=e.i(879085),J=e.i(62912);let Z=e=>{let{hasImage:a,onSend:s,isStreaming:i}=e,{editImagePresets:n}=(0,x.useEditImagePresets)(),r=(0,W.useMobileSize)(),{t:o}=(0,w.useTranslation)("image-editor"),[l,c]=(0,S.useState)(null),[d,u]=(0,S.useState)(null),m=(0,S.useMemo)(()=>i||!a,[i,a]),p=(0,S.useCallback)(e=>{c(t=>t===e?null:e)},[c]),g=(0,S.useCallback)(e=>{if(!i)return c(null),s(e.prompt,e.presetId)},[i,s]),f=(0,S.useCallback)(()=>{if(!i)return c(null),s("Make video","make-video")},[i,s]),v=(0,S.useCallback)(e=>{let t=document.querySelector('[data-preset-id="'.concat(e,'"]'));if(!t)return{};let a=t.getBoundingClientRect();return a.right+12+200>window.innerWidth?{left:a.left-200-12,top:a.top+(a.height-150)/2}:{left:a.right+12,top:a.top+(a.height-150)/2}},[]);return(0,S.useEffect)(()=>{if(!l||r)return void u(null);let e=()=>{let e=document.body.querySelector("[data-highlighted][data-preset-id]"),t=(null==e?void 0:e.getAttribute("data-preset-id"))||null;t&&u(t)};e();let t=new MutationObserver(e);return t.observe(document.body,{attributes:!0,attributeFilter:["data-highlighted"],subtree:!0}),()=>{t.disconnect()}},[l,r]),(0,t.jsxs)("div",{className:"@container flex w-full xs:justify-center justify-start items-center overflow-x-auto xs:overflow-visible gap-2 xs:gap-3 relative z-30 no-scrollbar",children:[(0,t.jsx)(j.motion.div,{variants:{hidden:{opacity:0,y:10},visible:{opacity:1,y:0}},initial:"hidden",animate:"visible",transition:{duration:.15,ease:"easeInOut"},className:"bg-surface-base rounded-full",children:(0,t.jsxs)(h.Button,{variant:"filledSecondary",size:"md",className:"flex items-center justify-start py-3 border border-border-l1 rounded-3xl hover:text-fg-primary",onClick:f,children:[(0,t.jsx)(J.Play,{fill:"currentColor",strokeWidth:0,className:"size-4"}),o("button.make-video","Make video")]},"make-video")},"make-video-animation"),n.map((e,a)=>(0,t.jsx)(j.motion.div,{variants:{hidden:{opacity:0,y:10},visible:{opacity:1,y:0}},initial:"hidden",animate:"visible",transition:{duration:.15,ease:"easeInOut",delay:.06*(a+1)},className:"bg-surface-base rounded-full",children:r?(0,t.jsxs)(Q.Drawer,{open:e.category===l,onOpenChange:t=>{t?c(e.category):c(null)},children:[(0,t.jsx)(Q.DrawerTrigger,{disabled:m,asChild:!0,children:(0,t.jsx)($,{category:e,disabled:m})}),(0,t.jsxs)(Q.DrawerContent,{className:"max-h-[90dvh]",children:[(0,t.jsx)(Q.DrawerHeader,{children:(0,t.jsxs)(Q.DrawerTitle,{className:"flex items-center justify-center gap-2",children:[e.icon&&S.default.createElement(e.icon,{size:20,className:"text-secondary flex-shrink-0"}),e.label]})}),(0,t.jsx)("div",{className:"p-2 space-y-2 overflow-auto",children:e.presets.map(e=>(0,t.jsxs)(h.Button,{variant:"ghost",size:"lg",className:"w-full flex items-center justify-start gap-3 h-auto py-3",onClick:()=>g(e),children:[e.icon&&S.default.createElement(e.icon,{size:18,className:"text-secondary flex-shrink-0"}),(0,t.jsx)("span",{children:e.label})]},e.presetId))})]})]}):(0,t.jsxs)(X.DropdownMenu,{open:e.category===l,onOpenChange:()=>p(e.category),children:[(0,t.jsx)(X.DropdownMenuTrigger,{disabled:m,asChild:!0,children:(0,t.jsx)($,{category:e,disabled:m})}),(0,t.jsx)(X.DropdownMenuContent,{hideWhenDetached:!0,side:"top",sideOffset:8,className:"min-w-60 space-y-0.5 z-[100000]",onMouseLeave:()=>{u(null)},onWheel:e=>e.stopPropagation(),onKeyDown:e=>e.stopPropagation(),children:e.presets.map(a=>(0,t.jsxs)(X.DropdownMenuItem,{"data-preset-id":a.presetId,className:"flex items-center gap-2",onSelect:()=>g(a),children:[a.icon&&S.default.createElement(a.icon,{size:16,className:"text-secondary flex-shrink-0"}),a.label,d===a.presetId&&(0,Y.createPortal)((0,t.jsxs)(j.motion.div,{layoutId:"preset-preview",className:"fixed w-[200px] h-[150px] bg-surface-l4 border border-border-l1 rounded-2xl shadow-lg z-50 pointer-events-none flex items-center justify-center p-1.5",style:v(a.presetId),children:[(0,t.jsx)(K.ImageLoader,{className:"absolute inset-0"}),a.previewUrl&&(0,t.jsx)(V.default,{src:a.previewUrl,alt:a.presetId,width:200,height:150,priority:!r&&l===e.category,className:"w-full h-full object-cover rounded-xl relative z-10"})]}),document.body)]},a.presetId))})]})},e.category))]})},$=S.default.forwardRef((e,a)=>{let{category:s,disabled:i,...n}=e;return(0,t.jsxs)(h.Button,{ref:a,size:"md",variant:"filledSecondary",rounded:!0,className:(0,N.cn)(!i&&"*:hover:text-primary transition-all"),disabled:i,...n,children:[s.icon&&S.default.createElement(s.icon,{size:16,className:"flex-shrink-0 text-secondary transition-colors"}),(0,t.jsx)("span",{children:s.label})]})});var ee=e.i(8681),et=e.i(351958),ea=e.i(283272),es=e.i(218946);let ei=e=>{let{onUploadImage:a}=e,{t:s}=(0,w.useTranslation)("base"),i=(0,z.useFileStore)(U.prop("fetchUploadFile")),n=(0,z.useFileStore)(U.prop("removeByConversationId")),o=(0,r.useChatPageStore)(U.prop("conversationId")),{ASSET_SERVER_URL:c}=(0,l.useEnvironment)(),d=(0,es.useRequestErrorToastFn)(),u=(0,S.useRef)(null),[m,p]=(0,S.useState)(!1),[g,x]=(0,S.useState)(!1),f=(0,S.useCallback)(()=>{var e;null==(e=u.current)||e.click()},[]),v=(0,S.useCallback)(async e=>{let t;if(1!==e.length||!e[0])return void F.toast.error(s("Only a single image file is allowed","Only a single image file is allowed"));if(!["image/png","image/jpeg","image/jpg","image/webp"].includes(e[0].type))return void F.toast.error(s("Only image files are allowed","Only image files are allowed"));x(!0);try{let a=i(e[0],o||"no_conversation_id");t=await a.metadataPromise}catch(e){d("image-editor-upload:uploadFile",e)}t instanceof Error&&d("image-editor-upload:uploadFile",t,s("Failed to upload file","Failed to upload file")),x(!1),n(o||"no_conversation_id"),!t||t instanceof Error||a({url:(0,L.getAssetUrl)(c,t.fileUri),metadata:t})},[s,i,o,a,c,n,d]),y=(0,S.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),g||p(!0)},[g]),k=(0,S.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),p(!1)},[]),C=(0,S.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),p(!1),!g)return v(Array.from(e.dataTransfer.files))},[v,g]),N=(0,S.useCallback)(e=>{if(e.target.files)return v(Array.from(e.target.files)).finally(()=>{u.current&&(u.current.value="")})},[v]);return(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},onDragOver:y,onDragLeave:k,onDrop:C,className:"border resize transition-colors w-full max-w-7xl h-full flex justify-center items-center border-border-l1 rounded-2xl p-8 mb-3 text-center ".concat(m&&!g&&"bg-surface-l1 border-border-l1"),children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,t.jsx)("div",{className:"p-4 rounded-full text-fg-secondary transition-colors bg-surface-l1",children:(0,t.jsx)(b.AnimatePresence,{mode:"popLayout",children:m&&!g?(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,t.jsx)(ee.Files,{className:"size-6"})},"files"):(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,t.jsx)(et.ImagePlusIcon,{className:"size-6"})},"image-plus")})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-primary",children:s("Upload an image to begin","Upload an image to begin")}),(0,t.jsx)(b.AnimatePresence,{mode:"popLayout",children:g?(0,t.jsx)(j.motion.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary",children:s("Uploading image","Uploading image")},"uploading"):m?(0,t.jsx)(j.motion.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary",children:s("Drop image here","Drop image here")},"dragging"):(0,t.jsx)(j.motion.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary",children:s("Drag and drop to upload","Drag and drop to upload")},"not-dragging")})]}),(0,t.jsx)("div",{className:"flex gap-3",children:(0,t.jsxs)(h.Button,{variant:"outline",className:"text-fg-primary hover:bg-button-ghost-hover rounded-2xl transition-all py-2.5 px-4 h-auto *:hover:text-fg-primary *:hover:transition-colors",disabled:g,autoFocus:!0,onClick:f,children:[g?(0,t.jsx)(I.Spinner,{size:"xxs"}):(0,t.jsx)(ea.Upload,{className:"size-4 text-fg-secondary"}),s("Upload","Upload")]})}),(0,t.jsx)("input",{ref:u,className:"hidden",type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:N,multiple:!1,"data-testid":"file-input"})]})})};var en=e.i(420986);let er=()=>{let{ASSET_SERVER_URL:e}=(0,l.useEnvironment)(),a=(0,P.useFeatureFlags)(),s=(0,A.useLogEvent)(),{t:i}=(0,w.useTranslation)("base"),n=(0,T.useMaybeRefreshAnonSession)(),{handleSendStart:c,timeToSendStart:d,consumeTimeToSendMs:u}=(0,_.useImageEditingMetrics)(),[m,p]=(0,D.useLocalStorage)("image-editor-first-open",!0),g=(0,R.useImageEditorStore)(U.prop("isOpen")),h=(0,R.useImageEditorStore)(U.prop("currentImage")),x=(0,R.useImageEditorStore)(U.prop("setImage")),f=(0,r.useChatPageStore)(U.prop("conversationId")),v=(0,r.useChatPageStore)(U.prop("streamedMessageId")),j=(0,r.useChatPageStore)(U.prop("lastMessageId")),I=(0,O.useResponseStore)(e=>e.byId[null!=v?v:""]),C=(0,O.useResponseStore)(U.prop("byId")),N=(0,S.useMemo)(()=>{var e;return null!=(e=O.useResponseStore.getState().byConversationId[null!=f?f:""])?e:[]},[f]),H=(0,en.useGenImagineVideoFromMediaUrl)(),[q,W]=(0,S.useState)(""),[V,Y]=(0,S.useState)(!1),[K,Q]=(0,S.useState)(null),[X,J]=(0,S.useState)(!1),[$,ee]=(0,S.useState)(!1),[et,ea]=(0,S.useState)(!1),[es,er]=(0,S.useState)(!1),[eo,el]=(0,S.useState)(!1),ec=(0,S.useMemo)(()=>!!h,[h]),ed=(0,S.useMemo)(()=>!!(h&&"key"in h),[h]),eu=(0,S.useMemo)(()=>!!(h&&"metadata"in h),[h]),em=(0,S.useMemo)(()=>{if(ed){if(V)return!K&&I&&Q(I.responseId),I||C[null!=K?K:""];let e=N.filter(e=>e.streamingImageById).find(e=>{for(let t in e.streamingImageById){let a=e.streamingImageById[t];if(!a)continue;let s=a[100];if((null==s?void 0:s.imageUrl)===(null==h?void 0:h.url))return!0}});return e||(null==N?void 0:N.find(e=>{var t,a;return null==(t=e.generatedImageUrls)?void 0:t.includes(null!=(a=h.assetKey)?a:"")}))}},[h,N,ed,V,I,K,C]),ep=(0,S.useMemo)(()=>(null==em?void 0:em.parentResponseId)?C[em.parentResponseId]:void 0,[em,C]),eg=(0,S.useMemo)(()=>ep?(0,L.getAssetUrl)(e,ep.imageEditUri):void 0,[ep,e]),eh=(0,S.useMemo)(()=>{if(eu){var t,a;return[{id:null!=(t=h.metadata.fileUri)?t:"",url:null!=(a=(0,L.getAssetUrl)(e,h.metadata.fileUri))?a:"",isModerated:!1,progressMap:void 0}]}return ed?em?V&&em.streamingImageById?Object.entries(em.streamingImageById).map(t=>{var a;let[s,i]=t,n=Object.keys(i).map(Number),r=i[Math.max(...n)];return{id:s,url:null!=(a=(0,L.getAssetUrl)(e,null==r?void 0:r.imageUrl))?a:"",isModerated:!1,progressMap:n.map(t=>{var a,s;return{progress:t/100,imageUrl:null!=(s=(0,L.getAssetUrl)(e,null==(a=i[t])?void 0:a.imageUrl))?s:""}})}}):em.generatedImageUrls.map(t=>{var a,s;let i=null!=(s=Object.values(null!=(a=em.streamingImageById)?a:{})[0])?s:{},n=Object.keys(i).map(Number);return{id:t,url:(0,L.getAssetUrl)(e,t),isModerated:!1,progressMap:n.length>0?n.map(t=>{var a,s;return{progress:t/100,imageUrl:null!=(s=(0,L.getAssetUrl)(e,null==(a=i[t])?void 0:a.imageUrl))?s:""}}):void 0}}):[]:[]},[h,em,ed,V,e,eu]),ex=(0,S.useMemo)(()=>eh.length>1?eh.find(e=>e.id===(null==h?void 0:h.key)||e.id===(null==h?void 0:h.assetKey)):eh[0],[eh,h]),ef=(0,S.useMemo)(()=>(0,t.jsx)(G,{isEditingCurrentImage:V,focusedImage:ex,parentImageUrl:es?void 0:eg,isPeekingParent:X,setIsPeekingParent:J,generatedImageWidth:null==em?void 0:em.generatedImageWidth,generatedImageHeight:null==em?void 0:em.generatedImageHeight,isParentImageLoaded:et,isFinalImageLoaded:eo,setIsFinalImageLoaded:el,setIsParentImageLoaded:ea}),[V,ex,X,eg,null==em?void 0:em.generatedImageWidth,null==em?void 0:em.generatedImageHeight,et,eo,es]),ev=(0,S.useCallback)(()=>{(null==ex?void 0:ex.url)&&H(ex.url).catch(e=>{(0,y.logError)("image-editor:handleMakeVideo",e)})},[null==ex?void 0:ex.url,H]),ey=(0,S.useCallback)(e=>{e&&x(e)},[x]),eb=(0,S.useCallback)(e=>{let t=eh[e];t&&(V&&x({key:t.id}),x({key:t.id,assetKey:t.id,url:t.url,isModerated:t.isModerated,progress:(null==t?void 0:t.progressMap)?Math.max(...Object.keys(t.progressMap).map(Number)):1}))},[eh,V,x]),ej=(0,S.useCallback)(async e=>(ee(!0),e().finally(()=>{ee(!1)})),[]),eS=(0,o.useHandleAbort)("image-workbench:handleAbort",ej),ew=(0,S.useCallback)(async(e,t)=>{if(!e.trim()||!(null==h?void 0:h.url))throw Error("No message or image");let s=r.useChatPageStore.getState(),i=B.useSettingsStore.getState(),o=O.useResponseStore.getState(),l=z.useFileStore.getState(),c=t.replace(/^https?:\/\/[^/]+\/?/,"");W(""),l.removeByConversationId(s.conversationId||"no_conversation_id"),l.removeAttachByConversationId(s.conversationId||"no_conversation_id"),await n();let d=s.lastMessageId?o.byId[s.lastMessageId]:void 0;if(s.lastMessageId&&!d)throw Error("Last message is missing");if((null==d?void 0:d.sender)==="human")throw Error("Last message is human");"none"!==s.reasoningMode&&s.setReasoningMode("none");let u={message:e,toolOverrides:{imageGen:!0},imageEditUri:c,enableRetries:!0},m=eu&&h.metadata.fileMetadataId&&!(null==ep?void 0:ep.message)?[h.metadata.fileMetadataId]:[];if(eu)return s.conversationId?s.sendResponse({...u,parentResponseId:s.lastMessageId,conversationId:s.conversationId,fileAttachmentIds:m,webpageUrls:[],setOpimisticUserResponse:!0,setUserResponse:!0,ff:a}):s.establishNewConversation({...u,fileAttachmentIds:[h.metadata.fileMetadataId],temporary:i.isIncognito,ff:a});if(!s.conversationId)throw Error("No conversation id");return s.sendResponse({...u,parentResponseId:s.lastMessageId,conversationId:s.conversationId,fileAttachmentIds:m,webpageUrls:[],setOpimisticUserResponse:!0,setUserResponse:!0,ff:a})},[h,n,eu,ep,a]),eI=(0,S.useCallback)(async(e,t)=>{let a=r.useChatPageStore.getState(),s=O.useResponseStore.getState(),i=a.streamedMessageId?s.byId[a.streamedMessageId]:void 0;return["streaming","optimistic","reconnecting"].includes((null==i?void 0:i.state)||"closed")&&await eS(),Y(!0),ew(e,t).catch(()=>{R.useImageEditorStore.getState().close()})},[ew,eS]),ek=(0,S.useCallback)(async(e,t)=>{if(e.trim()&&(null==ex?void 0:ex.url))return(s("edit_image_start",(0,_.formatImageEditUri)(ex.url),{queryType:t?"preset":"manual",location:"image-editor",presetId:t||"",message:e,messageLength:String(e.length),timeToSendMs:String(u())}),"make-video"===t)?ev():eI(e,ex.url).catch(e=>{(0,y.logError)("image-viewer:ImageEditor:handleEditCurrentImage",e)})},[eI,ex,s,u,ev]),eC=(0,S.useCallback)(()=>{if((null==ep?void 0:ep.message)&&eg)return s("edit_image_start",(0,_.formatImageEditUri)(eg),{queryType:"regenerate",location:"image-editor",presetId:"",message:null==ep?void 0:ep.message,messageLength:String(null==ep?void 0:ep.message),timeToSendMs:String(u())}),eI(ep.message,eg).catch(e=>{(0,y.logError)("image-viewer:ImageEditor:handleRegenerate",e)})},[ep,eg,eI,s,u]);(0,S.useEffect)(()=>{V&&eh.length&&eh[0]&&!eh.find(e=>e.id===h.key)&&x({key:eh[0].id})},[eh,V,h,x]),(0,S.useEffect)(()=>{let t=R.useImageEditorStore.getState();if(V&&I&&"error"===I.state)return t.close();if(V&&K&&I&&"closed"===I.state){var a,i,n,r;if(Y(!1),Q(null),!j)return t.close();let o=C[j];if(!o)return t.close();let l=null==(n=o.streamingImageById)||null==(i=n[null!=(r=null==h?void 0:h.key)?r:""])||null==(a=i[100])?void 0:a.imageUrl;if(!l)return t.close();s("edit_image_end",(0,_.formatImageEditUri)((null==ep?void 0:ep.imageEditUri)||""),{location:"image-editor"}),x({key:l,assetKey:l,url:(0,L.getAssetUrl)(e,l),progress:100,isModerated:!1})}},[ep,I,V,K,j,C,e,s,x]),(0,S.useEffect)(()=>{V||$||void 0!==d||c()},[u,c,V,$,d]),(0,S.useEffect)(()=>{if(null==ex?void 0:ex.url){el(!1);let e=new Image;e.onload=()=>el(!0),e.src=ex.url}},[null==ex?void 0:ex.url]),(0,S.useEffect)(()=>{if(eg){ea(!1),er(!1);let e=new Image;e.onload=()=>ea(!0),e.onerror=()=>er(!0),e.src=eg}},[eg]),(0,S.useEffect)(()=>{m&&g&&(p(!1),F.toast.message((0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-fg-primary font-bold",children:i("image-editor-welcome.title","Welcome to Image Editor")}),(0,t.jsx)("p",{className:"text-fg-secondary",children:i("image-editor-welcome.description","A focused space for you to transform images with Grok to anything you can imagine.")})]}),{duration:7e3}))},[m,g,p,i]);let eN=(0,R.useImageEditorStore)(U.prop("close"));return(0,t.jsxs)("div",{className:"flex flex-col items-center justify-between gap-6 sm:gap-20 w-full h-full",children:[(0,t.jsx)(k,{hasImage:ec,prompt:eg?null==ep?void 0:ep.message:void 0,focusedImageUrl:null==ex?void 0:ex.url,parentImageUrl:es?void 0:eg,isStreaming:V||$,onParentPeek:e=>J(e),onClose:eN,onRegenerate:eC}),ec?ef:g&&(0,t.jsx)(ei,{onUploadImage:ey}),(0,t.jsx)("footer",{className:"relative w-full max-w-2xl h-16 flex-shrink-0 mt-12 sm:mt-0",children:(0,t.jsxs)("div",{className:"absolute bottom-0 inset-x-0 flex flex-col gap-4",children:[(0,t.jsx)(b.AnimatePresence,{mode:"popLayout",children:ec&&eh&&eh.length>1&&(0,t.jsx)(M,{isStreaming:V||$,images:eh,focusedOption:eh.findIndex(e=>e.id===(null==ex?void 0:ex.id))||0,onSelect:eb})}),(0,t.jsx)(Z,{hasImage:ec,isStreaming:V||$,onSend:ek}),(0,t.jsx)(E.ImageEditorQueryBar,{hasImage:ec,inputValue:q,isStreaming:V||$,onInputValueChange:W,onSend:ek,onAbort:eS})]})})]})};var eo=e.i(687712),el=e.i(436562),ec=e.i(402423);let ed=()=>{let{t:e}=(0,w.useTranslation)("base"),a=(0,A.useLogEvent)(),s=(0,R.useImageEditorStore)(U.prop("isOpen")),i=(0,R.useImageEditorStore)(U.prop("close")),n=(0,r.useChatPageStore)(U.prop("conversationId")),[o,l]=(0,S.useState)(void 0),{handleEditorOpen:c,consumeEditorTimeMs:d,editorOpenTime:u}=(0,_.useImageEditingMetrics)();return(0,S.useEffect)(()=>{s&&void 0===u?c():s||void 0===u||a("image_editor_close",void 0,{timeInEditorMs:String(d()),location:"image-editor-dialog"})},[s,c,d,a,u]),(0,S.useEffect)(()=>{n!==o&&(o&&i(),l(n))},[n,i,o]),(0,t.jsx)(el.Dialog,{open:s,onOpenChange:e=>{e||i()},children:(0,t.jsxs)(eo.DialogPortal,{children:[(0,t.jsx)(el.DialogOverlay,{className:"fixed inset-0 z-50 bg-overlay duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0"}),(0,t.jsxs)(el.DialogContent,{"aria-describedby":e("image-editor.title","Image editor"),className:(0,N.cn)("fixed z-50 inset-0 bg-background duration-200 focus:outline-none","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 p-2 lg:p-6"),onCloseAutoFocus:e=>{e.preventDefault(),document.body.style.pointerEvents=""},children:[(0,t.jsx)(ec.VisuallyHidden,{children:(0,t.jsx)(eo.DialogTitle,{children:e("image-editor.title","Image editor")})}),(0,t.jsx)(er,{})]})]})})};var eu=e.i(572848),em=e.i(729009),ep=e.i(713087),eg=e.i(626205),eh=e.i(157695),ex=e.i(479268),ef=e.i(724499),ev=e.i(136783),ey=e.i(879199),eb=e.i(880020),ej=e.i(383293);e.i(31157);var eS=e.i(171686),ew=e.i(938270),eI=e.i(489843),ek=e.i(230433),eC=e.i(132841),eN=e.i(840580),eM=e.i(934652);let eE=e=>{let{height:a,width:s}=e,{i18n:i}=(0,w.useTranslation)("chat"),{isSuperGrokUser:r,isSuperGrokProUser:o}=(0,ek.useSubscriptions)(),{isSwitchingTeam:l}=(0,eM.useEnterprise)(),c=(0,eC.useIsActiveGrokBusinessSession)(),d=(0,B.useSettingsStore)(U.prop("selectedLanguage")),[u,m]=(0,S.useState)(0),p=(0,S.useMemo)(()=>d||i.languages.find(e=>e in eN.supportedLocaleToLanguage)||eN.globalLocale,[d,i.languages]),[g,h]=(0,S.useState)({isSuperGrokProUser:o,isSuperGrokUser:r,usingGrokBusiness:c});return(0,S.useEffect)(()=>{l||h(e=>(e.usingGrokBusiness!==c&&m(e=>e+1),{isSuperGrokProUser:o,isSuperGrokUser:r,usingGrokBusiness:c}))},[o,r,c,l,h]),(0,t.jsx)(b.AnimatePresence,{mode:"wait",initial:!1,children:(0,t.jsx)(j.motion.div,{initial:{opacity:1},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},children:g.usingGrokBusiness?(0,t.jsx)(n.BlackholeGrokBusinessLogo,{height:a,width:s}):g.isSuperGrokProUser?"ja"===p?(0,t.jsx)(n.SuperGrokHeavyJpLogo,{height:a,width:s}):(0,t.jsx)(n.SuperGrokHeavyLogo,{height:a,width:s}):g.isSuperGrokUser?"ja"===p?(0,t.jsx)(n.SuperGrokJpLogo,{height:a,width:s}):(0,t.jsx)(n.BlackholeSuperGrokLogo,{height:a,width:s}):"ja"===p?(0,t.jsx)(n.BlackholeGrokJpLogo,{height:a,width:s}):(0,t.jsx)(n.BlackholeGrokLogo,{height:a,width:s})},"logo-".concat(u))})};var eT=e.i(826921),eP=e.i(493845),e_=e.i(235289),eD=e.i(798045),eA=e.i(660168),eL=e.i(243634),ez=e.i(334172),eR=e.i(785239),eO=e.i(389052),eB=e.i(892621);e.s(["ImagineBanner",()=>eV],416872);var eU=e.i(584244),eF=e.i(443696),eH=e.i(81795),eG=e.i(926836),eq=e.i(10404);let eW=0;function eV(e){let{persistentBanner:a=!1}=e,{user:s}=(0,eu.useSession)(),{os:i}=(0,eG.useOs)(),n=(0,ey.useRouter)(),r=(0,A.useLogEvent)(),o=(0,W.useMobileSize)(),{push:l}=(0,ef.useRouting)(),[c,d]=(0,D.useLocalStorage)("visited-imagine2",!1),[u,p]=(0,D.useLocalStorage)("imagine-banner-impressions2",0);(0,S.useEffect)(()=>{!a&&(Date.now()<eW||(eW=Date.now()+12e4,p(e=>e+1)))},[]);let{resolvedTheme:g}=(0,eH.useTheme)(),h=(0,S.useCallback)(e=>{e.stopPropagation(),r("imagine_banner_clicked","imagine-banner",{location:"imagine-banner"}),l({page:"imagine"})},[l,r]),x=(0,S.useCallback)(e=>{e.stopPropagation(),d(!0),r("imagine_banner_dismissed","imagine-banner",{location:"imagine-banner"})},[d,r]);(0,S.useEffect)(()=>{r("imagine_banner_impression","imagine-banner",{location:"imagine-banner"})},[]);let f=(0,S.useCallback)(e=>{e.stopPropagation(),r("imagine_banner_clicked","imagine-banner",{location:"imagine-banner"});let t=new URLSearchParams({return_to:"/imagine"}).toString();r("sign_up_redirect",i,{location:"imagine-banner",os:i}),n.push("/sign-up".concat(t?"?".concat(t):""))},[r,i,n]),v=(0,S.useCallback)(e=>{e.stopPropagation(),r("imagine_banner_clicked","imagine-banner",{location:"imagine-banner"});let t=new URLSearchParams({return_to:"/imagine"}).toString();r("sign_in_redirect",i,{location:"imagine-banner",os:i}),n.push("/sign-in".concat(t?"?".concat(t):""))},[r,i,n]),{t:y}=(0,w.useTranslation)("imagine");return(0,t.jsxs)("div",{className:(0,N.cn)("relative dark max-w-[480px] w-full m-10",{"m-0 mb-24 mx-2":o}),children:[(0,t.jsxs)("div",{className:(0,N.cn)("flex dark flex-col items-center justify-center w-full rounded-3xl overflow-hidden  cursor-pointer bg-surface-l1 ",{"border-2 border-color-surface-l1":"dark"===g}),onClick:h,children:[(0,t.jsx)("div",{className:"relative w-full h-[110px] overflow-hidden",children:(0,t.jsx)(V.default,{priority:!0,quality:50,src:"/imagine-banner2.jpg",alt:y("imagine.banner.image.alt","Imagine promo banner image"),fetchPriority:"high",loading:"eager",fill:!0,className:"object-cover"})}),(0,t.jsxs)("div",{className:"flex flex-row items-center justify-between px-4 pt-0 pb-3 w-full",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,t.jsx)("p",{className:"dark text-primary text-sm font-bold m-0 p-0",children:y("imagine.banner_upgrades.title","Grok Imagine Upgrades")}),(0,t.jsx)(eq.NotificationBlip,{variant:"sm"})]}),(0,t.jsx)("p",{className:"dark text-fg-secondary text-sm m-0 p-0 ",children:y("imagine.banner_upgrades.subtitle","Generate videos with built-in audio - plus enhanced lifelike motion and character consistency")})]}),s&&(0,t.jsx)(eF.Button,{variant:"secondary",shape:"pill",size:"md",className:"dark font-bold text-primary",onClick:h,children:y("imagine.banner_upgrades.button","Try Now")})]}),!s&&(0,t.jsxs)("div",{className:"flex flex-row gap-4 items-start justify-start mb-3",children:[(0,t.jsxs)(eF.Button,{className:"font-semibold text-sm",variant:"primary",size:"sm",shape:"pill",onClick:f,children:[(0,t.jsx)(eU.User,{size:14}),y("Sign up","Sign up")]}),(0,t.jsx)(eF.Button,{className:"font-semibold text-sm",variant:"secondary",size:"sm",shape:"pill",onClick:v,children:y("Sign in","Sign in")})]})]}),!a&&(0,t.jsx)(eF.Button,{variant:"tertiary",shape:"circle",size:"xs",className:"dark font-bold text-primary absolute -top-2 -end-2 bg-surface-l2 hover:bg-surface-l4",onClick:x,"aria-label":"Close",children:(0,t.jsx)(m.XIcon,{className:"size-4"})})]})}var eY=e.i(407725),eK=e.i(997339),eQ=e.i(517176),eX=e.i(168413);function eJ(e){let{children:a,isValidProp:s,...i}=e;s&&(0,eQ.loadExternalIsValidProp)(s),(i={...(0,S.useContext)(eK.MotionConfigContext),...i}).isStatic=(0,eX.useConstant)(()=>i.isStatic);let n=(0,S.useMemo)(()=>i,[JSON.stringify(i.transition),i.transformPagePoint,i.reducedMotion]);return(0,t.jsx)(eK.MotionConfigContext.Provider,{value:n,children:a})}var eZ=e.i(815628),e$=e.i(410289),e0=e.i(749894),e1=e.i(944408),e2=e.i(229439);e.s(["useConversationTemplatePresets",()=>e5],512122);var e3=e.i(373882),e4=e.i(952447);let e6=(0,p.default)("UserRoundSearch",[["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M2 21a8 8 0 0 1 10.434-7.62",key:"1yezr2"}],["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["path",{d:"m22 22-1.9-1.9",key:"1e5ubv"}]]);var e8=e.i(798554);let e5=()=>({presets:e9}),e9=[{icon:e4.MessageCircleIcon,name:"Meeting Summary",description:"Summarize meeting transcripts into clear, actionable notes",systemPrompt:"You are a meeting notes assistant. Summarize the transcript into:\n- Decisions (what was agreed)\n- Action Items (with owners & deadlines)\n- Discussion Highlights (key topics covered).",inputGuidance:"Paste or upload the meeting transcript"},{icon:e6,name:"Candidate Evaluation",description:"Create a structured assessment of a candidate’s fit for a role",systemPrompt:"You are an HR assistant. Compare the CV against the job description. Write a structured report with:\n- Green Flags (strengths)\n- Red Flags (concerns)\n- Summary (overall impression)\n- Fit Score (1–10 with rationale).",inputGuidance:"Upload the candidate’s CV and paste the job description"},{icon:e3.LanguagesIcon,name:"Translate",description:"Translate English text into multiple languages",systemPrompt:"You are a professional translator. Translate the provided English text into: Chinese, Spanish, Hindi, Portuguese, Bengali, Russian, and Japanese. For each language, provide 3 natural variations that preserve the meaning and tone.",inputGuidance:"Paste English text you want to translate"},{icon:e8.Wrench,name:"Incident Report Draft",description:"Turn raw incident notes into a standardized postmortem draft",systemPrompt:"You are an SRE incident analyst. Write a postmortem report with:\n- Summary\n- Impact\n- Root Cause\n- Timeline of Events\n- Remediation / Prevention steps.",inputGuidance:"Upload incident notes, logs, or a timeline of events"}];e.i(298616);var e7=e.i(969286),te=e.i(154580),tt=e.i(364778),ta=e.i(194693),ts=e.i(840116);let ti=e=>{let{className:a}=e,{t:s}=(0,w.useTranslation)("base"),{push:i}=(0,ef.useRouting)(),n=(0,te.useQueryClient)(),{shouldShow:r,dismiss:o}=(0,ta.useTourGuideTooltip)({tooltipId:"templates"}),[l,c]=(0,S.useState)(!1),[d,u]=(0,D.useLocalStorage)("landing-page-templates.order-by","usageCount"),{results:m,isError:p,isLoading:g}=(0,eY.useListConversationTemplates)({orderBy:d,sharedWithMe:!1,pageSize:4}),{presets:h}=e5(),{mutate:x,isPending:f}=(0,e7.useMutation)({mutationFn:e=>tt.grokForTeamsApi.grokForTeamsTemplatesCreateTemplate({body:e})}),v=(0,S.useCallback)(e=>{let{templateName:t,templateDescription:a,inputGuidance:r,systemPrompt:l,assets:c,redirect:d}=e;if(!f)return o(),x({templateName:t||"",templateDescription:a||"",inputGuidance:r||"",systemPrompt:l||"",assets:c||[],sharedWithTeam:!1},{onSuccess:e=>{let{template:t}=e;if(t&&t.templateId)return"start-conversation"===d?i({page:"main",templateId:t.templateId}):"template-form"===d&&i({page:"templates",tab:"personal",templateId:t.templateId}),n.invalidateQueries({queryKey:(0,eY.getConversationTemplatesQueryKey)({})})},onError:()=>{F.toast.error(s("templates.failed-to-create-template","Failed to create template"))}})},[i,x,n,s,f,o]);return(0,t.jsx)(eJ,{transition:{duration:.2,ease:"easeInOut"},children:(0,t.jsxs)("div",{className:(0,N.cn)("@container/template-widget w-full",a),children:[(0,t.jsxs)("div",{className:"px-4 flex justify-between items-center gap-3",children:[(0,t.jsxs)("div",{className:"flex items-baseline gap-2.5",children:[(0,t.jsx)(ts.TourGuideBubble,{shouldShow:r,onDismiss:o,title:s("templates.guide-tooltip.title","Templates"),description:s("templates.guide-tooltip.description","Use templates to turn prompts into reusable starting points, making recurring tasks faster and more consistent."),badgeText:s("templates.guide-tooltip.new","new"),tooltipContentProps:{side:"right",sideOffset:4},children:(0,t.jsx)("div",{className:"text-base font-semibold text-fg-primary",children:s("templates.title","Templates")})}),(0,t.jsxs)(X.DropdownMenu,{open:l,onOpenChange:c,children:[(0,t.jsx)(X.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)("button",{className:"text-sm text-fg-tertiary flex items-center gap-1 focus:outline-none cursor-pointer focus:ring-1 ring-primary pl-1.5 p-1 -my-1 -ml-1.5 rounded-lg",children:[(0,t.jsx)("span",{className:"whitespace-nowrap",children:"createTime"===d?s("templates.order-by.create-time","Most recent"):s("templates.order-by.usage-count","Most used")}),(0,t.jsx)(e1.ChevronDownIcon,{className:(0,N.cn)("size-3.5 text-fg-tertiary transition-transform",{"rotate-180":l})})]})}),(0,t.jsxs)(X.DropdownMenuContent,{sideOffset:8,side:"bottom",align:"end",className:"min-w-40",children:[(0,t.jsxs)(X.DropdownMenuItem,{onSelect:()=>u("createTime"),className:"flex items-center gap-2 justify-between",children:[(0,t.jsx)("span",{children:s("templates.order-by.create-time","Most recent")}),"createTime"===d&&(0,t.jsx)(e0.CheckIcon,{className:"text-fg-primary size-4"})]},"createTime"),(0,t.jsxs)(X.DropdownMenuItem,{onSelect:()=>u("usageCount"),className:"flex items-center gap-2 justify-between",children:[(0,t.jsx)("span",{children:s("templates.order-by.usage-count","Most used")}),"usageCount"===d&&(0,t.jsx)(e0.CheckIcon,{className:"text-fg-primary size-4"})]},"usageCount")]})]})]}),(0,t.jsx)(ef.Link,{onClick:o,route:{page:"templates",tab:"personal"},className:"text-sm text-fg-tertiary font-semibold hover:text-fg-secondary transition-all outline-none focus:ring-1 ring-primary rounded-lg px-2 py-1 -m-2",children:s("templates.see-all","See all")})]}),p?(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex justify-center items-center mx-4 py-6 mt-4 border border-border-l1 rounded-2xl",children:(0,t.jsx)("span",{className:"text-fg-tertiary text-sm",children:s("templates.failed-to-load","Failed to load templates")})},"error"):g||m.length?(0,t.jsx)("div",{className:"px-4 mt-4 grid grid-cols-2 w-full gap-4",children:(0,t.jsx)(b.AnimatePresence,{initial:!1,children:Array.from({length:4}).map((e,a)=>{let s=m[a];return(0,t.jsx)(tn,{template:s,isLoading:g,onCustomTemplateSelect:()=>v({redirect:"template-form"}),onPresetTemplateSelect:e=>v({templateName:e.templateName,templateDescription:e.templateDescription,inputGuidance:e.inputGuidance,systemPrompt:e.systemPrompt,redirect:"template-form"})},"template-".concat(a))})})}):(0,t.jsxs)("div",{className:"rounded-2xl border border-border-l1 flex flex-col justify-center items-center gap-4 p-6 mt-4",children:[(0,t.jsx)("div",{className:"text-sm text-fg-secondary font-semibold",children:s("templates.try-preset-templates","Try these templates")}),(0,t.jsxs)("div",{className:"flex items-center justify-center flex-wrap gap-3 max-w-lg",children:[h.slice(0,4).map(e=>(0,t.jsx)("div",{onClick:()=>v({templateName:e.name,templateDescription:e.description,inputGuidance:e.inputGuidance,systemPrompt:e.systemPrompt,redirect:"start-conversation"}),className:"px-3 py-1.5 rounded-full bg-surface-l1 border border-border-l1 hover:bg-surface-l2 transition-colors cursor-pointer",children:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("div",{children:(0,t.jsx)(e.icon,{size:16,className:"text-fg-secondary"})}),(0,t.jsx)("span",{className:"text-fg-primary font-semibold text-sm truncate",children:e.name})]})},e.name)),(0,t.jsxs)(eF.Button,{variant:"secondary",size:"sm",shape:"pill",onClick:()=>v({redirect:"template-form"}),children:[(0,t.jsx)(e2.Plus,{size:18,className:"-ml-0.5"}),s("templates.add-new","Add")]})]})]})]})})},tn=e=>{let{template:a,isLoading:s,onCustomTemplateSelect:i,onPresetTemplateSelect:n}=e,{t:r}=(0,w.useTranslation)("base"),{presets:o}=e5(),[l,c]=(0,S.useState)(!1),{startConversationWithTemplate:d}=(0,eZ.useConversationTemplate)({templateId:(null==a?void 0:a.templateId)||null}),u=(0,S.useMemo)(()=>!s&&!a,[s,a]),m=(0,S.useCallback)(e=>{u&&c(e)},[u]),p=(0,S.useCallback)(()=>{a&&!s&&d()},[a,s,d]);return(0,t.jsxs)(X.DropdownMenu,{open:l,onOpenChange:m,children:[(0,t.jsx)(X.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(j.motion.button,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:p,className:(0,N.cn)("group p-3 flex flex-col bg-surface-l1 border border-border-l1 rounded-2xl transition-colors relative outline-none focus:ring-1 ring-primary",{"cursor-pointer hover:bg-surface-l2":!s,"bg-transparent":u,"bg-surface-l2":l}),children:[(0,t.jsx)("div",{className:"h-5 flex items-center min-w-0",children:(0,t.jsx)(b.AnimatePresence,{mode:"wait",initial:!1,children:s?(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,t.jsx)(e$.Skeleton,{className:"h-3 w-40 rounded-sm"})},"loading-name"):a&&(0,t.jsx)(j.motion.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-primary font-semibold truncate",children:a.templateName||r("templates.values.name.placeholder","New Template")},"title")})}),(0,t.jsx)("div",{className:"h-5 flex items-center min-w-0 ",children:(0,t.jsx)(b.AnimatePresence,{mode:"wait",initial:!1,children:s?(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,t.jsx)(e$.Skeleton,{className:"h-3 w-24 rounded-sm"})},"loading-description"):a&&(0,t.jsx)(j.motion.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-fg-secondary text-sm truncate",children:a.templateDescription||r("templates.values.description.placeholder","Description")},"description")})}),(0,t.jsx)(b.AnimatePresence,{initial:!1,children:u&&(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:(0,N.cn)("absolute inset-0 flex justify-center items-center"),children:(0,t.jsx)(e2.Plus,{size:20,className:(0,N.cn)("opacity-25 group-hover:opacity-50 transition-opacity",{"opacity-50":l})})},"empty-state")}),u&&(0,t.jsx)("span",{className:"sr-only",children:r("templates.values.name.placeholder","New Template")})]})}),u&&(0,t.jsxs)(X.DropdownMenuContent,{align:"end",sideOffset:8,children:[(0,t.jsxs)(X.DropdownMenuItem,{className:"flex items-center gap-2",onSelect:i,children:[(0,t.jsx)(e2.Plus,{size:16,className:"text-secondary flex-shrink-0"}),(0,t.jsx)("p",{children:r("templates.custom-template","Custom Template")})]}),o.map(e=>(0,t.jsxs)(X.DropdownMenuItem,{className:"flex items-center gap-2",onSelect:()=>null==n?void 0:n({templateName:e.name,templateDescription:e.description,inputGuidance:e.inputGuidance,systemPrompt:e.systemPrompt}),children:[(0,t.jsx)(e.icon,{size:16,className:"text-secondary flex-shrink-0"}),(0,t.jsx)("p",{children:e.name})]},e.name))]})]})};var tr=e.i(540942),to=e.i(910503),tl=e.i(432286),tc=e.i(738416);function td(e){return(0,tc.startOfDay)(Date.now(),e)}var tu=e.i(921127),tm=e.i(119470),tp=e.i(495794);function tg(e,t,a){return(0,tp.addMonths)(e,-t,a)}var th=function(e){return e.PAST_30_DAYS="past-30-days",e.THIS_MONTH="this-month",e.THIS_YEAR="this-year",e.PAST_3_MONTHS="past-3-months",e.PAST_6_MONTHS="past-6-months",e}({});let tx=e=>{let{isError:a,title:s,timeRangeOptions:i,selectedTimeRange:n,onTimeRangeChange:r,children:o}=e,{t:l}=(0,w.useTranslation)("base"),[c,d]=(0,S.useState)(!1),u=(0,S.useCallback)(e=>{switch(e){case"past-30-days":return l("team-insights.time-range.past-30-days","Past 30 days");case"this-month":return l("team-insights.time-range.this-month","This month");case"this-year":return l("team-insights.time-range.this-year","This year");case"past-3-months":return l("team-insights.time-range.past-3-months","Past 3 months");case"past-6-months":return l("team-insights.time-range.past-6-months","Past 6 months")}},[l]),m=(0,S.useMemo)(()=>u(n),[n,u]);return(0,t.jsxs)("div",{className:"h-full flex flex-col",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-xs text-fg-secondary",children:s}),(null==i?void 0:i.length)?(0,t.jsxs)(X.DropdownMenu,{open:c,onOpenChange:d,children:[(0,t.jsxs)(X.DropdownMenuTrigger,{className:"text-xs text-fg-tertiary flex items-center gap-1 focus:outline-none",children:[(0,t.jsx)("span",{className:"whitespace-nowrap",children:m}),(0,t.jsx)(e1.ChevronDownIcon,{className:(0,N.cn)("size-3 text-fg-tertiary transition-transform",{"rotate-180":c})})]}),(0,t.jsx)(X.DropdownMenuContent,{sideOffset:8,align:"end",className:"min-w-40",children:i.map(e=>(0,t.jsxs)(X.DropdownMenuItem,{onSelect:()=>null==r?void 0:r(e),className:"flex items-center gap-2 justify-between",children:[(0,t.jsx)("span",{children:u(e)}),e===n&&(0,t.jsx)(e0.CheckIcon,{className:"text-fg-primary size-4"})]},e))})]}):(0,t.jsx)("span",{className:"text-xs text-fg-tertiary",children:m})]}),(0,t.jsx)("div",{className:"flex flex-col justify-between mt-3 w-full h-12",children:a?(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex justify-center items-center h-full border border-border-l1 rounded-2xl",children:(0,t.jsx)("span",{className:"text-fg-tertiary text-sm",children:l("team-insights.error-loading-data","Could not load data")})},"error"):o})]})},tf=e=>{switch(e){case"past-30-days":return(0,tm.subDays)(td(),29).toISOString();case"this-month":return(0,tl.startOfMonth)(td()).toISOString();case"this-year":return(0,tu.startOfYear)(td()).toISOString();case"past-3-months":return(0,tl.startOfMonth)(tg(td(),2)).toISOString();case"past-6-months":return(0,tl.startOfMonth)(tg(td(),5)).toISOString()}};var tv=e.i(203857);let ty=()=>{let{t:e}=(0,w.useTranslation)("base"),{currentTeam:a,isSwitchingTeam:s}=(0,eM.useEnterprise)(),[i,n]=(0,D.useLocalStorage)("team-insights.messages-counters-time-range",th.THIS_MONTH),r=(0,S.useMemo)(()=>tf(i),[i]),{data:o,isFetching:l,isError:c}=(0,to.useQuery)({queryKey:["team-stats",null==a?void 0:a.teamId,r],queryFn:async()=>tt.grokForTeamsApi.grokForTeamsGetTeamStats({fromTime:r,maxEntries:3}),enabled:!!(null==a?void 0:a.teamId)&&!s,staleTime:1/0}),d=(0,S.useMemo)(()=>l||s,[l,s]),u=(0,tv.useDebouncedValue)(d,300,[d]),m=(0,S.useMemo)(()=>[{count:parseInt(u?"0":(null==o?void 0:o.messageCount)||"0"),label:e("team-insights.you","You")},{count:parseInt(u?"0":(null==o?void 0:o.totalMessages)||"0"),label:e("team-insights.team","Team")}],[o,e,u]);return(0,t.jsx)(tx,{title:e("team-insights.messages","Messages"),timeRangeOptions:[th.THIS_MONTH,th.PAST_3_MONTHS,th.PAST_6_MONTHS,th.THIS_YEAR],selectedTimeRange:i,onTimeRangeChange:e=>n(e),isError:c,children:m.map((e,a)=>(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsx)("span",{className:"text-xs text-fg-secondary",children:e.label}),(0,t.jsx)(b.AnimatePresence,{mode:"wait",initial:!1,children:d?(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"h-6 flex items-center justify-end",children:(0,t.jsx)(e$.Skeleton,{className:(0,N.cn)("h-2 w-10 rounded-sm",{"w-20":1===a})})},"loading"):(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"h-6",children:(0,t.jsx)(tr.default,{value:e.count,className:"text-sm font-semibold"})},"count")})]},e.label))})},tb=()=>{let{t:e}=(0,w.useTranslation)("base"),{currentTeam:a,isSwitchingTeam:s}=(0,eM.useEnterprise)(),[i,n]=(0,D.useLocalStorage)("team-insights.sharing-leaderboard-time-range",th.THIS_MONTH),r=(0,S.useMemo)(()=>tf(i),[i]),{data:o,isFetching:l,isError:c}=(0,to.useQuery)({queryKey:["team-stats",null==a?void 0:a.teamId,r],queryFn:async()=>tt.grokForTeamsApi.grokForTeamsGetTeamStats({fromTime:r,maxEntries:3}),enabled:!!(null==a?void 0:a.teamId)&&!s,staleTime:1/0}),d=(0,S.useMemo)(()=>l||s,[l,s]),u=(0,S.useMemo)(()=>{var e,t;let a=Array.from({length:3}).map(()=>({name:" - ",shareLinkCount:0}));return[...(null==o||null==(t=o.topUsers)||null==(e=t.map(e=>{var t,a;return{name:"".concat(null==(t=e.user)?void 0:t.givenName," ").concat(null==(a=e.user)?void 0:a.familyName),shareLinkCount:parseInt(e.shareLinkCount||"0")}}))?void 0:e.sort((e,t)=>t.shareLinkCount-e.shareLinkCount))||[],...a].slice(0,3)},[o]);return(0,t.jsx)(tx,{title:e("team-insights.top-sharers","Top sharers"),timeRangeOptions:[th.THIS_MONTH,th.PAST_3_MONTHS,th.PAST_6_MONTHS,th.THIS_YEAR],selectedTimeRange:i,onTimeRangeChange:e=>n(e),isError:c,children:u.map((a,s)=>{let{name:i,shareLinkCount:n}=a;return(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3 w-full h-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1 min-w-0",children:[(0,t.jsx)("span",{className:"text-fg-secondary text-[12px] w-3 text-start tabular-nums",children:s+1}),(0,t.jsx)(b.AnimatePresence,{initial:!1,mode:"wait",children:d?(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,t.jsx)(e$.Skeleton,{className:"h-2 w-20 rounded-sm"})},"loading"):(0,t.jsx)(j.motion.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-fg-primary text-xs truncate",children:i},"name")})]}),(0,t.jsx)(b.AnimatePresence,{initial:!1,mode:"wait",children:d?(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,t.jsx)(e$.Skeleton,{className:"h-2 w-20 rounded-sm"})},"loading"):(0,t.jsx)(j.motion.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-xs text-fg-tertiary whitespace-nowrap",children:e("team-insights.share-count","{{count}} shared",{count:n})},"count")})]},"".concat(s,"-").concat(i))})})};var tj=e.i(355524),tS=e.i(103882);e.i(406151);var tw=e.i(488842),tI=function(e){return e[e.NONE=0]="NONE",e[e.LOW=1]="LOW",e[e.MEDIUM=2]="MEDIUM",e[e.HIGH=3]="HIGH",e[e.VERY_HIGH=4]="VERY_HIGH",e}(tI||{});let tk=()=>{let{t:e}=(0,w.useTranslation)("base"),{resolvedTheme:a}=(0,eH.useTheme)(),{currentTeam:s,isSwitchingTeam:i}=(0,eM.useEnterprise)(),n=(0,S.useMemo)(()=>tf(th.PAST_30_DAYS),[]),{data:r,isLoading:o,isError:l}=(0,to.useQuery)({queryKey:["team-stats",null==s?void 0:s.teamId,n],queryFn:async()=>tt.grokForTeamsApi.grokForTeamsGetTeamStats({fromTime:n,maxEntries:3}),enabled:!!(null==s?void 0:s.teamId)&&!i,staleTime:1/0}),c=(0,S.useMemo)(()=>{let e=Array.from({length:30}).map((e,t)=>{var a,s,i;let o=new Date(n);return o.setDate(o.getDate()+t),parseInt((null==r||null==(i=r.teamStats)||null==(s=i.stats)||null==(a=s.find(e=>e.startTime&&(0,tS.isSameDay)(e.startTime,o)))?void 0:a.totalMessages)||"0")}),t=e.filter(e=>e>0),a=[0,1,20,50];if(t.length>0){let e=[...t].sort((e,t)=>e-t),s=e[Math.floor(.25*e.length)]||1;a=[0,s,e[Math.floor(.5*e.length)]||1,e[Math.floor(.75*e.length)]||1]}return Array.from({length:30}).map((t,s)=>{let i=new Date(n);i.setDate(i.getDate()+s);let r=e[s]||0,o=0===r?0:r<=a[1]?1:r<=a[2]?2:r<=a[3]?3:4;return{date:i.toISOString(),totalMessages:r,colorLevel:o}})},[n,r]),d=(0,S.useMemo)(()=>o||i,[o,i]);return(0,t.jsx)(tx,{title:e("team-insights.team-usage","Team usage"),selectedTimeRange:th.PAST_30_DAYS,isError:l,children:(0,t.jsx)("div",{className:"grid grid-cols-12 content-between w-full h-full max-w-[260px] place-items-stretch",children:c.map((s,i)=>(0,t.jsxs)(tj.Tooltip,{disableHoverableContent:!0,delayDuration:0,children:[(0,t.jsx)(tj.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("div",{className:(0,N.cn)("group w-full h-full flex items-center justify-center"),children:(0,t.jsx)("div",{className:(0,N.cn)("duration-200 transition-all",{"group-hover:scale-125":!d}),children:(0,t.jsx)("div",{className:(0,N.cn)("w-3 h-3 border border-border-l1 rounded-[4px] transition-all duration-500",{"animate-pulse":d}),style:{backgroundColor:tC[a||"dark"][d?0:s.colorLevel],animationDelay:"".concat(.03*i,"s"),animationDuration:"1s"}})})})}),!d&&(0,t.jsx)(tj.TooltipContent,{children:(0,t.jsx)("span",{className:"text-xs",children:s.totalMessages?e("team-insights.day-with-activity","{{count}} messages on {{date}}",{date:(0,tw.format)(s.date,"MMMM do"),count:s.totalMessages}):e("team-insights.day-without-activity","No activity on {{date}}",{date:(0,tw.format)(s.date,"MMMM do")})})})]},s.date))})})},tC={dark:{0:"#1D1E20",1:"#242628",2:"#3E3F41",3:"#57595B",4:"#B5B5B5"},light:{0:"#F3F3F1",1:"#BFBEBD",2:"#9F9E9D",3:"#646362",4:"#4B4A48"}},tN=e=>{let{className:a}=e;return(0,t.jsx)(eJ,{transition:{duration:.2,ease:"easeInOut"},children:(0,t.jsx)("div",{className:(0,N.cn)("@container/team-insights w-full",a),children:(0,t.jsxs)("div",{className:"grid grid-cols-1 @[500px]/team-insights:grid-cols-2 @[700px]/team-insights:grid-cols-3 w-full",children:[(0,t.jsx)("div",{className:"hidden @[500px]/team-insights:block pl-4 pr-6",children:(0,t.jsx)(tk,{})}),(0,t.jsxs)("div",{className:"hidden @[700px]/team-insights:block px-6 relative",children:[(0,t.jsx)(ty,{}),(0,t.jsx)("div",{className:"hidden @[500px]/team-insights:block absolute left-0 inset-y-1 border-l border-border-l1"})]}),(0,t.jsxs)("div",{className:"pr-4 pl-6 relative",children:[(0,t.jsx)(tb,{}),(0,t.jsx)("div",{className:"hidden @[500px]/team-insights:block absolute left-0 inset-y-1 border-l border-border-l1"})]})]})})})},tM={7:"grok-4-mini-thinking-tahoe"};var tE=e.i(369699);e.i(49854);var tT=e.i(304902),tP=e.i(446583),t_=e.i(298438),tD=e.i(498647);e.i(70015);var tA=e.i(338363),tL=e.i(971463),tz=e.i(665739);let tR=e=>{let{value:a,formatter:s,prefix:i,suffix:n,className:r}=e,o=a>0?"+":a<0?"-":"",l=Math.abs(a),c=s?s(l):l;return(0,t.jsxs)("span",{className:(0,N.cn)(a>0?"text-teal-300":a<0?"text-red-300":"text-muted-foreground",r),children:[i,!!o&&o,c,n]})};var tO=e.i(809846);function tB(e){var a,s,i,n,r,o,l,c,d,u,m,p,g,h,x,f,v,y,b,j,S,I,k;let{suggestion:C}=e,{ENABLE_COMPACT_QUERY_BAR:M}=(0,P.useFeatureFlags)(),E=(0,W.useMobileSize)(640),T={type:"finance",label:null!=(x=(l=C.summary).ticker)?x:"",payload:{type:"stockMiniSummary",summary:{ticker:null!=(f=l.ticker)?f:"",name:null!=(v=null==(c=l.stockOverview)?void 0:c.name)?v:"",value:null!=(y=null==(d=l.financeValue)?void 0:d.value)?y:0,change:null!=(b=null==(u=l.financeValue)?void 0:u.change)?b:0,changePercent:null!=(j=null==(m=l.financeValue)?void 0:m.changePercent)?j:0,unit:null!=(S=null==(p=l.financeValue)?void 0:p.unit)?S:"",market:null!=(I=null==(g=l.stockOverview)?void 0:g.market)?I:"",tickerType:null!=(k=null==(h=l.stockOverview)?void 0:h.tickerType)?k:""}}}.payload,{i18n:_}=(0,w.useTranslation)("finance"),D=null!=(s=T.summary.value)?s:0,A=null!=(i=T.summary.change)?i:0,L=null!=(n=T.summary.changePercent)?n:0,z=(null==(a=C.summary.stockOverview)?void 0:a.currency)||"USD",R=(null!=(o=null!=(r=T.summary.name)?r:T.summary.ticker)?o:"").replace(" Common Stock",""),O=(0,tL.getStockIconUrl)(T.summary.ticker);return(0,t.jsxs)("div",{className:(0,N.cn)("flex gap-3 px-1 @sm:ps-5 @sm:pe-3 h-10 items-center",M&&!E&&"@sm:ps-3"),children:[O?(0,t.jsx)("img",{src:O,alt:T.summary.ticker,className:"w-[18px] h-[18px] rounded-sm"}):(0,t.jsx)("div",{className:"flex items-center justify-center w-[18px] h-[18px]",children:(0,t.jsx)(tz.TrendingUp,{className:"text-fg-secondary",size:18})}),(0,t.jsxs)("div",{className:"flex-1 gap-1 flex items-center overflow-hidden whitespace-nowrap",children:[(0,t.jsx)("span",{className:"text-fg-primary",children:T.summary.ticker}),(0,t.jsx)("span",{children:"·"}),(0,t.jsx)("span",{className:"truncate flex-1",children:R}),(0,t.jsx)("span",{className:"font-semibold",children:(0,tO.formatPrice)(D,z,_.language)})," ",(0,t.jsx)(tR,{value:A,formatter:e=>e.toFixed(D<1?3:2)})," ",(0,t.jsx)(tR,{value:L,formatter:e=>"".concat(e.toFixed(2),"%"),prefix:"(",suffix:")"})]})]})}let tU=e=>{let{suggestion:a,search:s,className:i}=e,n=a.text.split(" ").map(e=>({text:e,isHighlighted:!1})),r=s.split(" ");return n=n.map((e,t)=>{if(t>=r.length||!r[t])return e;let a=r[t].toLowerCase()===e.text.toLowerCase();return{...e,isHighlighted:a}}),(0,t.jsx)("div",{className:i,children:n.map((e,a)=>{if(a===r.length-1&&r[a]&&e.text.toLowerCase().includes(r[a])){var s;let i=((e,t)=>{var a,s;let i="",n=0;for(;n<e.length&&(null==(a=e[n])?void 0:a.toLowerCase())===(null==t||null==(s=t[n])?void 0:s.toLowerCase());)i+=e[n],n++;return i})(e.text,r[a]);return(0,t.jsxs)(S.Fragment,{children:[(0,t.jsx)("span",{className:"font-medium text-muted-foreground",children:i}),(0,t.jsxs)("span",{className:"text-primary",children:[null==(s=e.text)?void 0:s.slice(null==i?void 0:i.length)," "]})]},a)}return e.isHighlighted?(0,t.jsxs)("span",{className:"font-medium text-muted-foreground",children:[e.text," "]},a):(0,t.jsxs)("span",{className:"text-primary",children:[e.text," "]},a)})})};var tF=e.i(69052),tH=e.i(279598);let tG=(0,p.default)("MessagesSquare",[["path",{d:"M14 9a2 2 0 0 1-2 2H6l-4 4V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2z",key:"p1xzt8"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1",key:"1cx29u"}]]);var tq=e.i(65992),tW=e.i(246727),tV=e.i(987325),tY=e.i(221891);let tK={},tQ=(0,tV.default)(()=>{(0,y.logMetric)("autocomplete",{type:"suggestion_view",counters:tK}),tK={}},10),tX=e=>{let{suggestions:a,position:s,onPositionChange:i,onPositionSelect:n,highlightText:r,keyboardNavigationEnabled:o=!0,className:l,incrementSuggestionsShownCount:c}=e,{ENABLE_COMPACT_QUERY_BAR:d}=(0,P.useFeatureFlags)(),u=(0,W.useMobileSize)(640),m=(0,S.useCallback)(e=>{n(e)},[n]);return(0,S.useEffect)(()=>{let e=null==a?void 0:a.length;if(!e||!o)return;let t=t=>{if("Enter"===t.key&&!t.shiftKey&&void 0!==s){t.preventDefault(),t.stopPropagation(),m(s);return}let a=0;"ArrowDown"===t.key&&(t.preventDefault(),void 0!==s&&(a=(s+1)%e),s===e-1&&(a=void 0)),"ArrowUp"===t.key&&(t.preventDefault(),void 0!==s&&(a=(s-1)%e),0===s&&(a=void 0),void 0===s&&(a=e-1)),("ArrowUp"===t.key||"ArrowDown"===t.key)&&i(a)};return document.addEventListener("keydown",t,{capture:!0}),()=>document.removeEventListener("keydown",t,{capture:!0})},[s,i,a,m,o]),(0,t.jsx)("ul",{className:(0,N.cn)("flex flex-col-reverse sm:flex-col overflow-hidden bg-background",l,d&&a.length>0&&!u&&" -mt-[20px] bg-surface-l1 px-2 shadow-[0_4px_6px_-1px_rgba(0,0,0,0.1)] rounded-b-3xl pb-2 border border-inset border-t-0 ".concat("border-border-l1")),onMouseLeave:()=>{i(void 0)},children:a.map((e,a)=>(0,t.jsx)("li",{dir:"auto",className:(0,N.cn)("cursor-pointer rounded-xl",s===a?"sm:border-input-border-focus sm:bg-button-ghost-hover":""),onMouseMove:e=>{let t=0!==e.movementX||0!==e.movementY;a!==s&&t&&i(a)},onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},onClick:()=>{m(a)},children:(0,t.jsx)(tJ,{suggestion:e,highlightText:r,onReady:c})},JSON.stringify(e)))})};function tJ(e){let{suggestion:a,highlightText:s,onReady:i}=e;return((0,S.useEffect)(()=>{null==i||i();let e=tK[a.type]||0;tK[a.type]=e+1,tQ()},[i,a]),"stock"===a.type)?(0,t.jsx)(tB,{suggestion:a}):"project"===a.type?(0,t.jsx)(t$,{icon:(0,t.jsx)(tA.WorkspaceIconView,{icon:a.project.icon,size:18}),children:(0,t.jsx)("div",{className:"truncate",children:a.project.name})}):"conversation"===a.type?(0,t.jsx)(t$,{icon:(0,t.jsx)(tG,{size:18}),children:(0,t.jsxs)("div",{className:"truncate",children:[(0,t.jsx)("span",{children:a.conversation.title}),(0,t.jsx)(tF.Timestamp,{conversation:a.conversation,className:"ms-1.5 text-fg-tertiary hidden @sm:block align-baseline"})]})}):"math"===a.type?(0,t.jsx)(t$,{icon:(0,t.jsx)(tH.Calculator,{size:18}),children:(0,t.jsx)("div",{className:"truncate",children:a.result})}):"answer"===a.type?(0,t.jsx)(t0,{icon:(0,t.jsx)(tW.Zap,{size:18}),text:a.text,children:(0,t.jsx)("div",{className:"truncate text-fg-primary",children:a.text})}):(0,t.jsx)(t$,{icon:(0,t.jsx)(tD.default,{size:18}),children:(0,t.jsx)(tU,{className:"flex-1",suggestion:a,search:s})})}function tZ(e){let{children:a}=e,{ENABLE_COMPACT_QUERY_BAR:s}=(0,P.useFeatureFlags)(),i=(0,W.useMobileSize)(640);return(0,t.jsx)("div",{className:(0,N.cn)("typeahead-mask flex gap-3 px-1 @sm:ps-5 @sm:pe-0 h-10 items-center",s&&!i&&"@sm:ps-3"),dir:"auto",children:a})}function t$(e){let{icon:a,children:s}=e;return(0,t.jsxs)(tZ,{children:[(0,t.jsx)("div",{className:(0,N.cn)("block justify-start text-fg-secondary shrink-0 grow-0"),children:a}),(0,t.jsx)("div",{className:"flex-auto min-w-0 overflow-hidden truncate",children:s})]})}function t0(e){let{icon:a,children:s,text:i}=e,{t:n}=(0,w.useTranslation)("chat"),r=(0,S.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),(0,y.logEventGlobal)("autocomplete_suggestion_copy",void 0,{location:"autocomplete_suggestion_row",suggestion_text:i}),(0,tY.copyAndToast)(i,n("autocomplete_suggestion_copy.toast","Copied to clipboard"))},[i,n]);return(0,t.jsxs)(tZ,{children:[(0,t.jsx)("div",{className:(0,N.cn)("block justify-start text-fg-secondary shrink-0 grow-0"),children:a}),(0,t.jsxs)("div",{className:"truncate text-fg-primary relative w-full",children:[(0,t.jsxs)("div",{className:"absolute -left-0 top-0 w-full flex flex-row",dir:"auto",children:[(0,t.jsx)("div",{className:"max-w-[calc(100%-75px)] truncate overflow-hidden invisible inline-block",children:s}),(0,t.jsx)(eF.Button,{shape:"square",size:"xs",variant:"tertiary","aria-label":n("autocomplete_suggestion_copy.label","Copy to clipboard"),className:"ms-2",onClick:r,children:(0,t.jsx)(tq.CopyIcon,{})})]}),s]})]})}var t1=e.i(982899);function t2(e){let{className:a,handleSend:s,position:i,setPosition:n,incrementSuggestionsShownCount:o=()=>{}}=e,{push:l}=(0,ef.useRouting)(),c=(0,r.useChatPageStore)(U.prop("setProjectId")),d=(0,r.useChatPageStore)(U.prop("conversationId"))||"no_conversation_id",u=(0,r.useChatPageStore)(e=>e.queryByConversationId[d])||"",m=(0,S.useCallback)(e=>{let{idsetQueryByConversationId:t}=r.useChatPageStore.getState();t(e,d)},[d]),p=(0,A.useLogEvent)(),[g,h]=(0,S.useState)(u),x=(0,tT.useSuggestions)(g),f=function(e,t){let{ENABLE_UNSELECTED_LOG:a}=(0,P.useFeatureFlags)(),s=(0,S.useRef)(new Map),i=(0,S.useCallback)(t=>{if(a&&s.current.size){if(s.current.size>100)return void s.current.clear();if(void 0!==t){let a=e[t];a&&s.current.delete(a)}for(let[e,t]of s.current)(0,y.logEventGlobal)("unselected_suggestion_view",void 0,{location:"ChatAutoCompleteSuggestions",suggestionType:e.type,text:(0,t1.getSuggestionLogLabel)(e),searchText:t});(0,y.logMetric)("autocomplete",{type:"unselected_log_emit",count:s.current.size}),s.current.clear()}},[e,a]);return(0,S.useEffect)(()=>{for(let a of e)s.current.set(a,t)},[e,t]),(0,S.useEffect)(()=>()=>i(),[]),i}(x,g),v=(0,S.useRef)(""),b=e=>{v.current=e,m(e)};(0,S.useEffect)(()=>{n(void 0)},[g,n]),(0,S.useEffect)(()=>{u||n(void 0),(v.current!==u||""===u)&&h(u)},[n,u]);let j=!u.includes("\n")&&u.length<75;return(0,t.jsx)(tX,{suggestions:x,position:i,onPositionChange:e=>{if(n(e),void 0===e)b(g);else{let a=x[e];if(((null==a?void 0:a.type)==="search"||(null==a?void 0:a.type)==="llm")&&b(a.text),(null==a?void 0:a.type)==="stock"){var t;b(null!=(t=a.summary.ticker)?t:"")}(null==a?void 0:a.type)==="math"&&b(a.result.toString())}},onPositionSelect:e=>{if(void 0===e)return;let t=x[e];if(!t)return;let a=(0,t1.getSuggestionLogLabel)(t);if(p("suggestion_selected",void 0,{suggestionType:t.type,position:String(i),location:"chat-autocomplete-suggestions",searchText:g,text:a}),(0,y.logMetric)("chat-autocomplete-suggestions",{type:"suggestion_selected",suggestionType:t.type}),"search"===t.type||"llm"===t.type?s({query:t.text,toolOverrides:{webSearch:!0,xSearch:!0,xMediaSearch:!0,trendsSearch:!0,xPostAnalyze:!0}}):"answer"===t.type&&s({query:g,toolOverrides:{webSearch:!0,xSearch:!0,xMediaSearch:!0,trendsSearch:!0,xPostAnalyze:!0}}),(null==t?void 0:t.type)==="stock"){var r;s({query:null!=(r=t.summary.ticker)?r:"",toolOverrides:{webSearch:!0,xSearch:!0,xMediaSearch:!0,trendsSearch:!0,xPostAnalyze:!0}})}(null==t?void 0:t.type)==="project"&&c(t.project.workspaceId),(null==t?void 0:t.type)==="conversation"&&l({page:"chat",conversationId:t.conversation.conversationId,temporary:!1}),(null==t?void 0:t.type)==="math"?(b(t.result.toString()),h(t.result.toString())):(b(""),h("")),f(e),n(void 0)},highlightText:g,keyboardNavigationEnabled:j,incrementSuggestionsShownCount:o,className:(0,N.cn)("z-10 no-touch-scrollbar","bg-background w-full",e_.QUERY_BAR_MAX_WIDTH_CLASS,a)})}var t3=e.i(798784);let t4=t3.z.enum(["deepsearch","brainstorm","analyzeData","createImage","code","search","createReport","finance"]),t6=t3.z.object({type:t3.z.literal("stockMiniSummary"),summary:t3.z.object({ticker:t3.z.string(),name:t3.z.string(),value:t3.z.number(),change:t3.z.number(),changePercent:t3.z.number(),unit:t3.z.string(),market:t3.z.string(),tickerType:t3.z.string()})}),t8=t3.z.discriminatedUnion("type",[t6]);t3.z.object({prefix:t3.z.string().optional(),prompt:t3.z.string().optional(),label:t3.z.string(),type:t4,icon:t3.z.string().optional(),payload:t8.optional(),route:t3.z.custom().optional()}),t3.z.object({label:t3.z.string(),prompt:t3.z.string().optional(),type:t4,img:t3.z.string().optional(),description:t3.z.string().optional(),prefix:t3.z.string().optional(),payload:t8.optional()});let t5=["en"],t9=[{type:"createImage",prefix:"Draw ",label:"Create Images",route:{page:"imagine"}},{type:"deepsearch",prefix:"Research ",label:"Research"},{type:"brainstorm",prefix:"How ",label:"How to"},{type:"analyzeData",prefix:"Help me ",label:"Analyze"},{type:"code",prefix:"Help me ",label:"Code"}];var t7=e.i(164221);let ae=(0,p.default)("ChartNoAxesColumnIncreasing",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]);var at=e.i(907736),aa=e.i(655890);e.i(916390);var as=e.i(297473),ai=e.i(258722),an=e.i(137278);function ar(){let e=(0,A.useLogEvent)(),a=(0,r.useChatPageStore)(e=>e.projectId),s=(0,r.useChatPageStore)(e=>e.setProjectId),i=(0,an.useWorkspaceStore)(e=>e.ensureWorkspace),{t:n}=(0,w.useTranslation)("base");(0,S.useEffect)(()=>{i(ai.DEEP_SEARCH_PROJECT_ID)},[i]);let o=(0,S.useCallback)(()=>{e("deepsearch_pill_clicked",void 0,{location:"deepsearch-suggestion-pill",target:"chip"}),s(a===ai.DEEP_SEARCH_PROJECT_ID?void 0:ai.DEEP_SEARCH_PROJECT_ID)},[e,a,s]);return(0,t.jsxs)(eF.Button,{variant:"secondary",size:"md",shape:"pill",onClick:o,children:[(0,t.jsx)(as.DeepSearchIcon,{size:16,strokeWidth:2,className:"text-secondary"}),n("deep-search","DeepSearch")]})}var ao=e.i(979566),al=e.i(7390),ac=e.i(567488);function ad(){let{exampleProjects:e}=(0,ac.useExampleProjects)(),{t:a}=(0,w.useTranslation)("base"),[s,i]=(0,S.useState)(!1),n=(0,ef.useRouting)(),r=(0,S.useCallback)(e=>{i(e)},[]),o=(0,S.useCallback)(e=>{i(!1),n.push({page:"workspace",workspaceId:e.workspaceId})},[n]),l=(0,S.useCallback)(()=>{an.useWorkspaceStore.getState().setCreateDialogIsOpen(!0)},[]),c=(0,S.useCallback)(()=>{n.push({page:"workspaces"})},[n]);return(0,t.jsxs)(X.DropdownMenu,{open:s,onOpenChange:r,children:[(0,t.jsx)(X.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(eF.Button,{variant:"secondary",size:"md",shape:"pill",children:[(0,t.jsx)(ao.FolderIcon,{size:16,strokeWidth:2,className:"text-secondary"}),a("try-projects","Try Projects"),(0,t.jsx)(e1.ChevronDownIcon,{size:12,strokeWidth:2,className:(0,N.cn)("text-secondary transition-transform duration-200",{"rotate-180":s})})]})}),(0,t.jsxs)(X.DropdownMenuContent,{children:[e.map(e=>(0,t.jsxs)(X.DropdownMenuItem,{className:"flex items-center gap-2",onClick:()=>o(e),children:[(0,t.jsx)(tA.WorkspaceIconView,{icon:e.icon}),(0,t.jsx)("p",{children:e.title})]},e.workspaceId)),(0,t.jsxs)(X.DropdownMenuItem,{onClick:l,children:[(0,t.jsx)(al.PlusIcon,{size:16,className:"me-2 text-secondary"}),a("create-project","Create Project")]}),(0,t.jsxs)(X.DropdownMenuItem,{onClick:c,children:[(0,t.jsx)(ao.FolderIcon,{size:16,className:"me-2 text-secondary"}),a("view-all-projects","View All Projects")]})]})]})}var au=e.i(762380);function am(e){let{suggestion:a,onClick:s}=e,{label:i}=a,n=(0,S.useCallback)(()=>{s(a)},[s,a]);return(0,t.jsxs)(eF.Button,{size:"md",variant:"secondary",shape:"pill",onClick:n,children:[(0,t.jsx)(ah,{suggestion:a}),(0,t.jsx)("p",{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:i})]})}function ap(e){let{handleSend:a,focusTextArea:s=()=>{}}=e,{push:i}=(0,ef.useRouting)(),n=(0,S.useMemo)(()=>t9,[]),{user:o}=(0,eu.useSession)(),l=(0,P.useFeatureFlags)(),c=(0,B.useSettingsStore)(U.prop("isIncognito")),d=!c,u=Math.min(n.length,5)-!!d-!!(o&&!c)-2,m=(0,au.useCurrentLanguage)(),{exampleProjects:p}=(0,ac.useExampleProjects)(),g=t5.includes(m),h=l.EXAMPLE_PROJECTS_SUGGESTION_PILL&&p.length>0,x=l.ENABLE_VOICE_MODE&&l.ENABLE_VOICE_MODE_PILL,f=(0,r.useChatPageStore)(U.prop("conversationId"))||"no_conversation_id",v=(0,r.useChatPageStore)(e=>e.queryByConversationId[f])||"",y=(0,S.useCallback)(e=>{let{idsetQueryByConversationId:t}=r.useChatPageStore.getState();t(e,f)},[f]),b=(0,A.useLogEvent)(),j=(0,S.useCallback)(e=>{if(e.route)i(e.route);else if(e.prefix){var t;let a="".concat(null==(t=e.prefix)?void 0:t.trim()).concat(v?":":"");(null==v?void 0:v.includes(a))||(y("".concat(a," ").concat(v)),null==s||s())}else e.prompt&&a({query:e.prompt,toolOverrides:{webSearch:!0,xSearch:!0,xMediaSearch:!0,trendsSearch:!0,xPostAnalyze:!0},isPreset:!1});b("click_suggestion_pill",e.label,{suggestionType:e.type,suggestionPrefix:String(e.prefix),suggestionPrompt:String(e.prompt),location:"chat-autocomplete-suggestions:handleClickTile"})},[y,v,a,b,s,i]),w=(0,S.useMemo)(()=>n.filter(e=>"deepsearch"!==e.type),[n]);return(0,t.jsx)("div",{className:"flex flex-col gap-2",children:(0,t.jsxs)("div",{className:"flex flex-row flex-wrap w-full gap-2 @sm:gap-2 justify-center items-center",children:[(0,t.jsx)(ar,{}),g&&w.slice(0,u).map(e=>{let a=e.type+e.prefix+e.prompt;return(0,t.jsx)(am,{suggestion:e,onClick:j},a)}),d&&!1,h?(0,t.jsx)(ad,{}):(0,t.jsx)(eP.LatestNewsPersona,{handleSend:a}),x?(0,t.jsx)(ag,{}):(0,t.jsx)(eP.PersonaPills,{handleSend:a})]})})}function ag(){let{t:e}=(0,w.useTranslation)("chat"),{handleVoiceModeEnter:a}=(0,eD.useVoiceMode)({location:"voice-mode-pill"});return(0,t.jsxs)(eF.Button,{size:"md",variant:"secondary",shape:"pill",onClick:a,children:[(0,t.jsx)(t7.AudioLinesIcon,{size:16,strokeWidth:2,className:"text-secondary"}),e("voice-mode-pill.label","Voice")]})}function ah(e){let{suggestion:a}=e,[s,i]=(0,S.useState)(!1),[n,r]=(0,S.useState)(!0);return a.icon&&!s?(0,t.jsxs)(t.Fragment,{children:[n&&(0,t.jsx)(af,{suggestion:a}),(0,t.jsx)("img",{src:a.icon,alt:"".concat(a.type," icon"),className:"me-2 h-[18px] w-[18px] object-contain",onError:()=>i(!0),onLoad:()=>r(!1),style:{display:n?"none":"block"}})]}):(0,t.jsx)(af,{suggestion:a})}let ax={className:"text-secondary",strokeWidth:2,size:18};function af(e){let{suggestion:a}=e;switch(a.type){case"deepsearch":return(0,t.jsx)(aa.ScanSearchIcon,{...ax});case"brainstorm":return(0,t.jsx)(tW.Zap,{...ax});case"analyzeData":case"createReport":return(0,t.jsx)(ae,{...ax});case"createImage":return(0,t.jsx)(et.ImagePlusIcon,{...ax});case"code":return(0,t.jsx)(at.Code,{...ax});default:return(0,t.jsx)(t.Fragment,{})}}var av=e.i(257239);let ay=(0,p.default)("AlarmClockCheck",[["circle",{cx:"12",cy:"13",r:"8",key:"3y4lt7"}],["path",{d:"M5 3 2 6",key:"18tl5t"}],["path",{d:"m22 6-3-3",key:"1opdir"}],["path",{d:"M6.38 18.7 4 21",key:"17xu3x"}],["path",{d:"M17.64 18.67 20 21",key:"kv2oe2"}],["path",{d:"m9 13 2 2 4-4",key:"6343dt"}]]);var ab=e.i(390864),aj=e.i(417508),aS=e.i(934290);let aw=e=>{let{onHide:a}=e,s=(0,A.useLogEvent)(),i=(0,W.useMobileSize)(),{t:n}=(0,w.useTranslation)("tasks"),{taskPresets:r}=(0,av.useTaskPresets)(),o=(0,eR.useTasksStore)(U.prop("setCreateDialogIsOpen")),l=(0,eR.useTasksStore)(U.prop("setTaskToEdit")),[c,d]=(0,S.useState)(ak(r)[0]),u=(0,S.useCallback)(()=>{s("task_preset_clicked",void 0,{location:"PresetTaskPill"}),o(!0),l(c)},[c,o,l,s]),m=(0,S.useCallback)(e=>{s("task_preset_clicked",void 0,{location:"PresetTaskPill"}),o(!0),l(e),d(e)},[o,l,s]);return c?(0,t.jsxs)("div",{className:"flex items-center gap-2 w-full justify-center",children:[(0,t.jsxs)("div",{className:(0,N.cn)("rounded-3xl p-3 bg-surface-l1 border text-xs flex items-center justify-between",{"min-w-[500px]":!i}),children:[(0,t.jsx)(aI,{value:c,onValueChange:m}),(0,t.jsxs)(h.Button,{variant:"filledSecondary",size:"sm",rounded:!0,onClick:u,className:"font-semibold",children:[(0,t.jsx)(ay,{size:14}),i?n("create-custom-task-dialog.schedule-task-short","Schedule"):n("create-custom-task-dialog.schedule-task","Schedule Task")]})]}),(0,t.jsx)(h.ButtonWithTooltip,{tooltipContent:(0,t.jsx)("p",{children:n("create-custom-task-dialog.schedule-task-hide","Hide")}),tooltipContentProps:{side:"bottom"},variant:"filledSecondary",size:"iconMd",rounded:!0,"aria-label":n("create-custom-task-dialog.schedule-task-hide","Hide"),onClick:a,children:(0,t.jsx)(aS.X,{size:14})})]}):null};function aI(e){let{value:a,onValueChange:s}=e,[i,n]=(0,S.useState)(!1),{taskPresets:r}=(0,av.useTaskPresets)(),{t:o}=(0,w.useTranslation)("tasks"),l=(0,W.useMobileSize)(),c=(0,S.useCallback)(e=>{n(e)},[]);return(0,t.jsxs)(X.DropdownMenu,{open:i,onOpenChange:c,children:[(0,t.jsx)(X.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(h.Button,{className:"flex items-center font-semibold",variant:"text","aria-label":o("selected-day.label","Selected day"),size:"sm",children:[a.cta||a.name,(0,t.jsx)(ab.ChevronDown,{size:14,className:(0,N.cn)("transition-transform duration-200",{"rotate-180":i})})]})}),(0,t.jsx)(X.DropdownMenuContent,{side:"bottom",align:"start",sideOffset:20,alignOffset:-12,className:(0,N.cn)({"w-[500px]":!l}),children:ak(r).map(e=>(0,t.jsxs)(X.DropdownMenuItem,{onSelect:()=>{s(e)},className:"group flex items-center justify-between gap-2",children:[e.name,(0,t.jsx)(aj.ChevronRight,{size:14,className:"opacity-0 group-hover:opacity-100"})]},e.name))})]})}function ak(e){for(let t=e.length-1;t>0;t--){let a=Math.floor(Math.random()*(t+1)),s=e[t],i=e[a];if(void 0===s||void 0===i)throw Error("shuffleArray: Unexpected undefined value");e[t]=i,e[a]=s}return e}e.s(["useSharedWithMeLinks",()=>aT],680126),e.i(866166);var aC=e.i(924219),aN=e.i(111669),aM=e.i(534626),aE=e.i(93910);function aT(e){let{pageSize:t=60,orderBy:a="createTime"}=e,s=(0,eu.useSession)(),i=(0,aE.useShareRoute)(),n=s.user,{currentTeam:r,isSwitchingTeam:o}=(0,eM.useEnterprise)(),{ASSET_SERVER_URL:c}=(0,l.useEnvironment)(),{data:d,isLoading:u}=(0,to.useQuery)({queryKey:["team-members",null==r?void 0:r.teamId],enabled:!!(null==r?void 0:r.teamId),queryFn:async()=>(null==r?void 0:r.teamId)?tt.authMgmtApi.authManagementListUsers({teamId:r.teamId}).then(e=>{var t;return(null==(t=e.members)?void 0:t.filter(e=>{var t;return(null==(t=e.user)?void 0:t.userId)!==(null==n?void 0:n.userId)}))||[]}).catch(e=>((0,y.logError)("share-dialog:fetch-team-members",e),[])):[]}),m=(0,S.useMemo)(()=>{let e=new Map;return null==d||d.forEach(t=>{var a,s,i,n,r,o;e.set((null==(a=t.user)?void 0:a.userId)||"",{userId:(null==(s=t.user)?void 0:s.userId)||"",xUserId:(null==(i=t.user)?void 0:i.xUserId)||"",givenName:(null==(n=t.user)?void 0:n.givenName)||"",familyName:(null==(r=t.user)?void 0:r.familyName)||"",profileImageUrl:(0,L.getAssetUrl)(c,null==(o=t.user)?void 0:o.profileImage)})}),e},[d,c]),p=(0,S.useRef)(null),g=(0,S.useRef)(null),[h,x]=(0,S.useState)(!1),[f,v]=(0,S.useState)(!1),b=(0,S.useCallback)(async e=>{let{pageParam:s}=e;if(!n)return{shareLinkResults:[],nextPageToken:void 0};let{shareLinks:i,nextPageToken:r}=await tt.chatApi.chatListShareLinks({sharedWithMe:!0,pageToken:"string"==typeof s?s:void 0,pageSize:t.toString(),orderBy:"createTime"===a?aC.ChatListShareLinksOrderByEnum.ListShareLinksOrderByCreateTime:"viewCount"===a?aC.ChatListShareLinksOrderByEnum.ListShareLinksOrderByViewCount:aC.ChatListShareLinksOrderByEnum.ListShareLinksOrderByInvalid});return{shareLinkResults:(null==i?void 0:i.map(e=>{var t;let{sharedLink:a,...s}=e;return{...s,conversation:(null==a?void 0:a.conversation)||null,response:(null==a||null==(t=a.responses)?void 0:t.find(t=>t.responseId===e.responseId))||null}}))||[],nextPageToken:r}},[n,t,a]),{data:j,fetchNextPage:w,hasNextPage:I,isFetchingNextPage:k,isFetching:C,isError:N,isLoading:M,refetch:E}=(0,aN.useInfiniteQuery)({queryKey:["share-links",null==n?void 0:n.userId,t,a],queryFn:b,initialPageParam:void 0,getNextPageParam:e=>e.nextPageToken,enabled:!!n&&!!(null==r?void 0:r.teamId)&&!o,staleTime:6e5,refetchOnWindowFocus:!0}),T=(0,S.useMemo)(()=>{var e;let t=(null==j||null==(e=j.pages.flatMap(e=>e.shareLinkResults))?void 0:e.filter(e=>!!e.shareLinkId))||[],s="createTime"===a?t.sort((e,t)=>new Date((null==t?void 0:t.createTime)||Date.now()).getTime()-new Date((null==e?void 0:e.createTime)||Date.now()).getTime()):t.sort((e,t)=>parseInt(t.viewCount||"0")-parseInt(e.viewCount||"0"));return aM.uniqBy(e=>null==e?void 0:e.shareLinkId,s).map(e=>({...e,user:(null==e?void 0:e.xaiUserId)?m.get(e.xaiUserId):void 0}))},[null==j?void 0:j.pages,m,a]),P=(0,S.useCallback)(e=>{let t=T.find(t=>t.shareLinkId===e);return(null==t?void 0:t.publicId)?i(t.publicId):i(e)},[T,i]),_=(0,S.useCallback)(e=>{window.location.href=P(e)},[P]);return(0,S.useEffect)(()=>{if(!(null==p?void 0:p.current)||!(null==g?void 0:g.current))return;let e=new IntersectionObserver(e=>{let[t]=e;t&&x(t.isIntersecting)},{root:g.current,rootMargin:"300px 0px 300px 0px",threshold:.1}),t=p.current;if(t)return e.observe(t),()=>{e.unobserve(t)}},[null==p?void 0:p.current,null==g?void 0:g.current]),(0,S.useLayoutEffect)(()=>{h&&I&&!k&&n&&!f&&(v(!0),w().catch(e=>(0,y.logError)("intersection-load-more",e)))},[h,I,k,w,n,f]),(0,S.useEffect)(()=>{if(f){let e=setTimeout(()=>{v(!1)},300);return()=>clearTimeout(e)}},[f]),{results:T,refetch:E,loadMoreRef:p,containerRef:g,isLoading:M,isFetching:C,isError:N,isLoadingTeamMembers:u,getShareLinkHref:P,handleNavigateToSharedConversation:_}}let aP=e=>{let{className:a}=e,{t:s}=(0,w.useTranslation)("base"),{isSwitchingTeam:i}=(0,eM.useEnterprise)(),{results:n,isFetching:r,isError:o,isLoadingTeamMembers:l,handleNavigateToSharedConversation:c}=aT({pageSize:60,orderBy:"viewCount"}),d=(0,S.useMemo)(()=>r||i,[r,i]);return(0,t.jsx)(eJ,{transition:{duration:.2,ease:"easeInOut"},children:(0,t.jsxs)("div",{className:(0,N.cn)("@container/shared-with-me w-full",a),children:[(0,t.jsxs)("div",{className:"px-4 flex justify-between items-center gap-3",children:[(0,t.jsx)("span",{className:"text-xs text-fg-secondary",children:s("team-insights.shared-with-me","Shared with me")}),(0,t.jsx)(ef.Link,{route:{page:"history",tab:"shared-with-me"},className:"text-xs text-fg-tertiary hover:text-fg-secondary transition-all",children:s("team-insights.see-all","See all")})]}),o?(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex justify-center items-center mx-4 py-6 mt-4 border border-border-l1 rounded-2xl",children:(0,t.jsx)("span",{className:"text-fg-tertiary text-sm",children:s("team-insights.error-loading-data","Could not load data")})},"error"):(0,t.jsx)("div",{className:"px-4 mt-4 grid grid-cols-3 w-full gap-4",children:(0,t.jsx)(b.AnimatePresence,{initial:!1,children:Array.from({length:3}).map((e,a)=>{let s=n[a];return(0,t.jsx)(a_,{shareLink:s,isLoading:d,isLoadingTeamMembers:l,onClick:s?()=>c(s.shareLinkId):void 0},"shared-with-me-".concat(a))})})})]})})},a_=e=>{var a,s,i;let{shareLink:n,isLoading:r,isLoadingTeamMembers:o,onClick:l}=e,c=(0,S.useMemo)(()=>!r&&!n,[r,n]);return(0,t.jsxs)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:l,className:(0,N.cn)("p-3 flex flex-col gap-2 bg-surface-l1 border border-border-l1 rounded-2xl transition-colors relative",{"cursor-pointer hover:bg-surface-l2":!!n&&!r,"bg-transparent":c}),children:[(0,t.jsx)("div",{className:"h-5 flex items-center min-w-0",children:(0,t.jsx)(b.AnimatePresence,{mode:"wait",initial:!1,children:r?(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,t.jsx)(e$.Skeleton,{className:"h-2 w-20 rounded-sm"})},"loading"):n&&(0,t.jsx)(j.motion.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-primary truncate",children:(null==(a=n.conversation)?void 0:a.title)||"Untitled Conversation"},"title")})}),(0,t.jsx)("div",{className:"h-4 flex items-center min-w-0 ",children:(0,t.jsx)(b.AnimatePresence,{mode:"wait",initial:!1,children:r||o?(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,t.jsx)(e$.Skeleton,{className:"h-2 w-16 rounded-sm"})},"loading-user"):n&&(0,t.jsx)(j.motion.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-fg-secondary text-xs truncate",children:"".concat((null==n||null==(s=n.user)?void 0:s.givenName)||""," ").concat((null==n||null==(i=n.user)?void 0:i.familyName)||"")},"user")})}),(0,t.jsx)(b.AnimatePresence,{initial:!1,children:c&&(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:(0,N.cn)("absolute inset-0 flex justify-center items-center"),children:(0,t.jsx)("div",{className:"w-10 border-b border-border-l1"})},"empty-state")})]})};var aD=e.i(745322);function aA(){let{t:e}=(0,w.useTranslation)("chat"),{isSuperGrokUser:a,isEnterpriseUser:s,isSuperGrokProUser:i,bestSubscription:n,isPending:o}=(0,ek.useSubscriptions)(),{data:{enableVoiceMode:l}={}}=(0,aD.useFeatureControls)(),c=(0,eR.useTasksStore)(U.prop("initialized")),d=(0,S.useRef)(""),{signInWithReturnTo:u}=(0,ep.useGrokRouter)(),m=(0,A.useLogEvent)(),p=(0,P.useFeatureFlags)(),{handleVoiceModeEnter:g}=(0,eD.useVoiceMode)({location:"chat-new"}),h=(0,r.useChatPageStore)(e=>e.establishNewConversation),x=(0,B.useSettingsStore)(U.prop("isIncognito")),v=(0,r.useChatPageStore)(U.prop("activeModelId")),I=(0,r.useChatPageStore)(U.prop("defaultAnonModelId")),k=(0,r.useChatPageStore)(U.prop("defaultFreeModelId")),C=(0,r.useChatPageStore)(U.prop("defaultProModelId")),M=(0,r.useChatPageStore)(U.prop("setDefaultAnonModelId")),E=(0,r.useChatPageStore)(U.prop("setDefaultFreeModelId")),_=(0,r.useChatPageStore)(U.prop("setDefaultProModelId")),L=(0,r.useChatPageStore)(U.prop("reasoningMode")),O=(0,r.useChatPageStore)(U.prop("setReasoningMode")),F=(0,r.useChatPageStore)(U.prop("conversationId")),H=(0,r.useChatPageStore)(U.prop("conversationId"))||"no_conversation_id",G=(0,r.useChatPageStore)(e=>e.queryByConversationId[H])||"",q=(0,W.useMobileSize)(),V=(0,W.useMobileSize)(640),Y=(0,f.useMobileUa)(),[K]=(0,D.useLocalStorage)("visited-imagine2",!1),[Q]=(0,D.useLocalStorage)("imagine-banner-impressions2",0),[X,J]=(0,S.useState)(!1);(0,S.useEffect)(()=>{G&&J(!0)},[G]);let Z=!Y&&!q&&(p.SHOW_IMAGINE_BANNER||!p.isReady)&&Q<=10&&!K&&0===G.length&&!X,$=p.ENABLE_COMPACT_QUERY_BAR,ee=$&&V?e("Ask Grok","Ask Grok"):e("query-bar-placeholder.1","What do you want to know?"),{sessionStartTime:et,conversationDepth:ea}=(0,eB.useTimeToValueAnalytics)(F),es=(0,z.useFileStore)(U.prop("listByConversationId")),ei=(0,z.useFileStore)(U.prop("attachListByConversationId")),en=(0,R.useImageEditorStore)(U.prop("isOpen")),er=(0,S.useMemo)(()=>es.no_conversation_id||[],[es]),eo=(0,S.useMemo)(()=>ei.no_conversation_id||[],[ei]),el=(0,eL.useForceSignInModels)(),ec=(0,W.useMobileSize)(),ed=(0,eC.useIsActiveGrokBusinessSession)(),em=(0,tT.useSuggestionStore)(e=>e.suggestions.length>0),eg=(0,tT.useSuggestionStore)(e=>e.clearList),eh=(0,S.useMemo)(()=>ed&&!x&&(ec||!em),[ed,em,x,ec]),ex=(0,S.useMemo)(()=>!x&&(er.length>0&&!!er.every(e=>e.file.type.includes("image"))||(null==eo?void 0:eo.length)>0&&!!eo.every(e=>e.mimeType.includes("image"))),[er,eo,x]),ef=(0,S.useMemo)(()=>!x&&(er.length>0&&!!er.every(e=>e.metadata&&e.file.type.includes("csv"))||(null==eo?void 0:eo.length)>0&&!!eo.every(e=>e.mimeType.includes("csv"))),[er,eo,x]),[ev,ey]=(0,S.useState)(!1),eN=(0,S.useCallback)(()=>{var e;let t=null!=(e=window.localStorage.getItem("hideTaskPillCount"))?e:0;window.localStorage.setItem("hideTaskPillCount",String(Number(t)+1)),ey(!1)},[]),eM=(0,T.useMaybeRefreshAnonSession)(),eU=(0,eu.useSession)().user,eF=(0,S.useRef)(null),eH=(0,S.useCallback)(()=>{var e;null==(e=eF.current)||e.focus()},[eF]);(0,eI.useHotkeys)(ew.KBD_NEW_CHAT,eH,[]);let{handleKeyDown:eG,consumeCompositionTimeMs:eq,consumeBackspaceCount:eW,consumeAvgKeystrokeLatency:eY,consumeKeystrokeCount:eK,position:eQ,setPosition:eX,consumePosition:eJ,consumeTypeaheadReqCount:eZ,incrementTypeaheadReqCount:e$,incrementSuggestionsShownCount:e0,consumeSuggestionsShownCount:e1}=(0,eA.useAutocompleteMetrics)(),e2=(0,S.useCallback)(e=>{"Escape"===e.key&&eg(),eG(e)},[eG,eg]),e3=(0,S.useCallback)(e=>{let{query:t,fileAttachmentIds:a,webpageUrls:s,toolOverrides:i,isPreset:r,workspaceIds:o,persona:l,isIncognitoOverride:c,disableMemory:d,modelIdOverride:g}=e;if(!t)return Promise.resolve(!1);if(!eU&&el.includes(g||v))return m("sign_in","chat-new",{location:"chat-new"}),u(t,L),Promise.resolve(!1);let f=B.useSettingsStore.getState(),b=eJ(),j=i;-1===b||void 0===b||i||(j={webSearch:!0});let S=(0,eO.toAnalytics)({activeModelId:g||v,modelMode:g?"":void 0,query:t,fileAttachmentIds:a,webpageUrls:s,location:"chat-new",personalityId:f.userSettings.preferences.selectedSystemPromptId||"",personaId:"",sessionStartTime:et,conversationDepth:ea,isMobile:q,bestSubscription:n,user:!!eU,compositionTime:eq(),backspaceCount:eW(),avgKeystrokeLatency:eY(),keystrokeCount:eK(),position:b,typeaheadRequestCount:eZ(),suggestionsShownCount:e1(),workspaceCount:(null==o?void 0:o.length)||0,toolOverrides:j,suggestionsSource:p.ENABLE_LLM_SUGGESTIONS?"grok":"bing",parentResponseId:""});return m("send_query","",S),eM().then(()=>((0,tE.reportSubmit)(),!!h({message:t,fileAttachmentIds:a,webpageUrls:s,toolOverrides:j,temporary:null!=c?c:x,isPreset:r,persona:l,enableRetries:!0,ff:p,workspaceIds:o,disableMemory:d,modelIdOverride:g}).catch((0,y.createLogError)("chat-new:establishNewConversation"))))},[v,eU,p,m,x,L,el,eM,h,eY,eW,eq,eK,eJ,e1,eZ,u,ea,q,et,n]),{modelById:e4,defaultAnonModelId:e6,defaultFreeModelId:e8,defaultProModelId:e5,isPending:e9}=(0,eL.useModels)(),e7=(0,r.useChatPageStore)(e=>e.setActiveModelId),te=(0,r.useChatPageStore)(e=>e.setModelMode);(0,S.useEffect)(()=>{if(e9||o&&eU)return;let e=new URLSearchParams(location.search),t=e.get("q"),n=e.get("reasoningMode"),r=e.get("fileid"),l=tM[Number(e.get("m"))],c=location.hash===t_.INCOGNITO_HASH;if(l&&e4[l])B.useSettingsStore.getState().fetchSetPreference("useModelModeSelector3",!1).catch((0,y.createLogError)("chat-new:mount:fetchSetPreference:useModelModeSelector3")),e7(l);else if(C!==e5&&(s||a||i)&&e5&&e4[e5])_(e5),e7(e5);else if(k!==e8&&eU&&e8&&e4[e8])E(e8),e7(e8);else if(I!==e6&&e6&&e4[e6])M(e6),e7(e6);else if(n){let e=ez.reasoningModeSchema.parse(n);e&&O(e)}t&&!d.current&&(e3({query:t,fileAttachmentIds:r?[r]:void 0,webpageUrls:[],isIncognitoOverride:c,disableMemory:!0,modelIdOverride:l}).catch(e=>{(0,y.logError)("chat-new:mount:handleSend",e)}),d.current="auto-start")},[e9,o]);let tt=(0,S.useCallback)(t=>{let{query:a,parentQuotedText:s,fileAttachmentIds:i,webpageUrls:n,toolOverrides:r,isPreset:o,persona:l}=t;if(l){let t=(0,eP.mapPersonaToSettings)(l.personaId,e);t.modelMode&&te(t.modelMode)}e3({query:a,parentQuotedText:s,fileAttachmentIds:i,webpageUrls:n,toolOverrides:r,persona:l,isPreset:o}).catch(e=>{(0,y.logError)("chat-new:handleClickSuggestion",e)})},[e3,te,e]),ta=(0,S.useCallback)(()=>{let t=[...er.map(e=>e.metadata).filter(e=>e&&!(e instanceof Error)).map(e=>e.fileMetadataId),...eo.map(e=>e.assetId)];e3({query:e("create-report-prompt","Create a report"),fileAttachmentIds:t}).catch(e=>{(0,y.logError)("chat-new:handleClickCreateReport",e)})},[e3,er,eo,e]);(0,S.useEffect)(()=>{(0,tE.reportPageReady)()},[]);let ts=(()=>{if(!em){if(ex&&!x)return(0,t.jsx)("div",{className:"bg-background rounded-full",children:(0,t.jsxs)(eb.ImageEditorTrigger,{shouldGetFromStore:!0,buttonProps:{variant:"filledSecondary",size:"md",rounded:!0},location:"chat-new-input",children:[(0,t.jsx)(eT.ScanImageIcon,{className:"size-5 text-secondary"}),e("Edit Image","Edit Image")]})},"edit");if(ef&&!x)return(0,t.jsx)(j.motion.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:"bg-background rounded-full",children:(0,t.jsx)(am,{suggestion:{type:"createReport",label:e("create-report","Create Report")},onClick:ta})},"edit");if(Z)return(0,t.jsx)(j.motion.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",transition:{duration:.1},exit:"hidden",className:(0,N.cn)("w-full flex justify-center",{invisible:x}),children:(0,t.jsx)(eV,{})},"imagine-banner");if(c&&!ec&&ev)return(0,t.jsx)(j.motion.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:(0,N.cn)("w-full flex justify-center",{invisible:x}),children:(0,t.jsx)(aw,{onHide:eN})},"task-pill");if(!ec&&!ex&&!ef&&eh)return(0,t.jsxs)(j.motion.div,{variants:{hidden:{opacity:0},visible:{opacity:1}},initial:"hidden",animate:"visible",transition:{duration:.2},className:(0,N.cn)("w-full",e_.QUERY_BAR_MAX_WIDTH_CLASS),children:[(0,t.jsx)(tN,{className:"w-full mt-7"}),p.ENABLE_TEMPLATES?(0,t.jsx)(ti,{className:"w-full mt-10 mb-6"}):(0,t.jsx)(aP,{className:"w-full mt-10 mb-6"})]},"teams-ui");if(!ec&&!x&&!ed)return(0,t.jsx)(ap,{focusTextArea:eH,handleSend:tt})}})();return(0,t.jsx)("div",{className:"flex flex-col items-center w-full h-full p-2 mx-auto justify-center @sm:p-4 @sm:gap-9 isolate mt-16 @sm:mt-0 overflow-scroll",children:(0,t.jsxs)("div",{className:(0,N.cn)("flex flex-col items-center gap-6 h-[450px] w-full @sm:pt-12 isolate transition-transform",{"-translate-y-20":ed&&!ec}),children:[(0,t.jsxs)("div",{className:(0,N.cn)("flex flex-col items-center justify-center w-full @sm:px-4 px-2 gap-6 @sm:gap-4 @xl:w-4/5 flex-initial pb-0",e_.QUERY_BAR_MAX_WIDTH_CLASS),children:[(0,t.jsx)(eE,{height:64,width:320}),ec&&(0,t.jsx)(b.AnimatePresence,{mode:"wait",initial:!1,children:eh?(0,t.jsx)(j.motion.div,{variants:{hidden:{opacity:0},visible:{opacity:1}},initial:"hidden",animate:"visible",transition:{duration:.2},className:(0,N.cn)("w-full",e_.QUERY_BAR_MAX_WIDTH_CLASS),children:(0,t.jsx)(tN,{className:"w-full my-6"})},"teams-ui"):em?null:(0,t.jsx)(ap,{focusTextArea:eH,handleSend:tt})})]}),(0,t.jsxs)("div",{className:(0,N.cn)("absolute bottom-0 mx-auto inset-x-0",e_.QUERY_BAR_MAX_WIDTH_CLASS,"@sm:relative flex flex-col items-center w-full gap-1 @sm:gap-5 @sm:bottom-auto @sm:inset-x-auto @sm:max-w-full"),children:[(0,t.jsxs)("div",{className:(0,N.cn)("flex flex-col-reverse items-center justify-between flex-1 w-full gap-0 @sm:gap-3 @sm:flex-col relative","p-2 @sm:p-0"),children:[(0,t.jsx)("div",{className:(0,N.cn)("w-full",$&&(!em||V)?"mb-3":""),children:(0,t.jsx)(ej.QueryBar,{className:"mt-2",textAreaClassName:$?"min-h-14 py-4 my-0 mb-0":"min-h-14 pt-5 my-0 mb-5",placeholder:ee,onQuery:e3,onFrontPage:!en,ref:eF,isIncognito:x,enableVoiceMode:l,onKeyDown:e2,onVoiceModeEnter:g,showingSuggestions:em&&!V&&!x,onBlur:eg},"query-bar")}),(0,t.jsx)(b.AnimatePresence,{mode:"wait",initial:!1,children:ts}),(0,t.jsx)(t2,{className:(0,N.cn)("overflow-visible",x&&"invisible",ec||"-mt-2"),handleSend:tt,position:eQ,setPosition:eX,incrementTypeaheadReqCount:e$,incrementSuggestionsShownCount:e0}),(0,t.jsx)(eS.UpsellSuperGrokSmall,{})]}),eU?null:(0,t.jsx)("div",{className:"text-[11px] @sm:text-xs text-secondary text-nowrap",children:(0,t.jsx)(tP.Trans,{ns:"chat",i18nKey:"clickwrapAgreement",defaults:"By messaging Grok, you agree to our <terms>Terms</terms> and <policy>Privacy Policy</policy>.",components:{terms:(0,t.jsx)("a",{className:"text-primary",href:"https://x.ai/legal/terms-of-service",target:"_blank",rel:"noopener noreferrer"}),policy:(0,t.jsx)("a",{className:"text-primary",href:"https://x.ai/legal/privacy-policy",target:"_blank",rel:"noopener noreferrer"})}})})]})]})})}var aL=e.i(211350),az=e.i(141769);function aR(e){let{conversationIsLoading:a,conversationError:s,optimisticConversationId:i,conversationId:n,conversation:o,templateId:l}=e,c=(0,es.useRequestErrorToastFn)(),d=(0,r.useChatPageStore)(U.prop("conversationMode")),{data:{enableVoiceMode:u}={}}=(0,aD.useFeatureControls)();return((0,S.useEffect)(()=>{(null==o?void 0:o.conversationId)&&O.useResponseStore.getState().loadInitialResponses(o.conversationId).then(e=>{var t;let a=r.useChatPageStore.getState();if(a.conversationId===(null==(t=e[0])?void 0:t.conversationId)){let t=(0,aL.getMostRecentResponse)(e);if(!t)return void a.setLastMessageId(void 0);if("streaming"===t.state||"reconnecting"===t.state){a.setLastMessageId(t.parentResponseId),a.setStreamedMessageId(t.responseId);return}if("optimistic"===t.state){a.setLastMessageId(t.parentResponseId),a.setOptimisticMessageId(t.responseId);return}a.setLastMessageId(t.responseId)}}).catch(e=>{c("chat-page:loadInitialResponses",e)})},[null==o?void 0:o.conversationId]),i)?(0,t.jsx)(az.ChatInteraction,{conversationId:i,conversation:void 0,isOptimisticConversation:!0,conversationIsLoading:a,conversationError:s,enableVoiceMode:u,templateId:l},"voice"===d?"voice-chat-interaction":"chat-interaction"):n?(0,t.jsx)(az.ChatInteraction,{conversationId:n,conversation:o||void 0,isOptimisticConversation:!1,conversationIsLoading:a,conversationError:s,enableVoiceMode:u},"chat-interaction"):null}e.s(["DropPrompt",()=>aF],689280);var aO=e.i(755666);e.i(200942);var aB=e.i(274920),aU=e.i(804220);function aF(e){let{conversationId:a,containerRef:s,user:i,imageAttachmentsOnly:n=!1}=e,{t:o}=(0,w.useTranslation)("chat"),l=function(e,t,a){let{t:s}=(0,w.useTranslation)("base"),i=(0,r.useChatPageStore)(U.prop("activeModelId")),{modelById:n}=(0,eL.useModels)(),o=null==n?void 0:n[i],{isAttachDisabled:l}=(0,eL.useModelFeatures)(o),{data:{enableImageUploads:c}={}}=(0,aD.useFeatureControls)(),{attachFiles:d}=(0,aO.useFileAttachments)(),u=(0,A.useLogEvent)(),{user:m}=(0,eu.useSession)(),p=(0,z.useFileStore)(U.prop("listByConversationId"))[e||"no_conversation_id"]||[];return"hover"===(0,aB.useDropZone)({onDrop:e=>{m&&(d(e),e.forEach(e=>{u("upload_file",e.name,{location:"file-drop",mimeType:e.type})}))},canDrop:e=>{var t;return!c&&e.files.some(e=>null==e?void 0:e.type.startsWith("image/"))?(F.toast.error(s("feature-controls.enable-image-uploads.forbidden","Image uploads are disabled for your team.")),!1):!l&&!!e.files.length&&(!a||!(e.files.length>1)&&!!(null==(t=e.files[0])?void 0:t.type.startsWith("image/")))&&(!p.length||!p.find(t=>{var a;return t.file.name===(null==(a=e.files[0])?void 0:a.name)}))},ref:t},[p,m,l,d])}(a,s,n),c=(0,r.useChatPageStore)(U.prop("activeModelId")),{modelById:d}=(0,eL.useModels)(),u=null==d?void 0:d[c],{isAttachDisabled:m,isThinkSelected:p,isDeepsearchSelected:g}=(0,eL.useModelFeatures)(u);return(0,t.jsx)(b.AnimatePresence,{children:l&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-overlay z-50"},"drop-backdrop"),(0,t.jsx)(j.motion.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:20},className:"absolute inset-0 z-50 flex items-center justify-center p-6 pointer-events-none",children:i?m?(0,t.jsxs)("div",{className:"rounded-2xl w-full max-w-xl bg-background flex flex-col items-center py-12 border-[1px] border-dashed border-input-border",children:[(0,t.jsx)("div",{children:(0,t.jsx)(aU.TriangleAlert,{size:32,className:"text-red-400"})}),(0,t.jsx)("h2",{className:"mt-4 text-lg font-medium text-primary",children:o("Attachments are disabled","Attachments are disabled")}),(0,t.jsxs)("p",{className:"text-secondary",children:[o("Attachments are disabled for","Attachments are disabled for")," ",(0,t.jsx)("span",{className:"font-semibold",children:p?"Think":g?"DeepSearch":void 0})]})]}):(0,t.jsxs)("div",{className:"rounded-2xl w-full max-w-xl bg-background flex flex-col items-center py-12 border-[1px] border-dashed border-input-border",children:[(0,t.jsx)("div",{children:(0,t.jsx)(et.ImagePlusIcon,{size:32,className:"text-secondary"})}),(0,t.jsx)("h2",{className:"mt-4 text-lg font-medium text-primary",children:o("Drop your files here","Drop your files here")}),(0,t.jsx)("p",{className:"text-secondary",children:o("Drop your files here to add them to your conversation","Drop your files here to add them to your conversation")})]}):(0,t.jsxs)("div",{className:"flex flex-col items-center w-full max-w-xl py-12 border-4 border-red-400 border-dashed rounded-2xl bg-background",children:[(0,t.jsx)("div",{children:(0,t.jsx)(et.ImagePlusIcon,{size:32,className:"text-secondary"})}),(0,t.jsx)("h2",{className:"mt-4 mb-2 text-lg font-medium text-red-400",children:o("Sign in to attach files!","Sign in to attach files!")}),(0,t.jsx)("p",{className:"text-secondary",children:o("You must be signed in to attach files to your conversation","You must be signed in to attach files to your conversation")})]})},"drop-modal")]})})}let aH=(0,p.default)("BellRing",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}]]);var aG=e.i(272809);let aq=e=>{let{onDismiss:a}=e,{t:s}=(0,w.useTranslation)("base"),[i,n]=(0,S.useState)("ASK"),r=(0,B.useSettingsStore)(U.prop("fetchSetPreference")),o=async()=>{if("granted"===Notification.permission||(n("WAIT"),"granted"===await Notification.requestPermission())){n("ALLOWED"),await r("browserNotificationsEnabled",!0);return}n("DENIED")};return((0,S.useEffect)(()=>{if("ASK"===i||"WAIT"===i)return;let e=setTimeout(a,2e3);return()=>clearTimeout(e)},[a,i]),(0,f.isMobileUa)())?null:"DENIED"===i?(0,t.jsxs)("div",{className:"flex items-center gap-4 min-w-[360px]",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-semibold",children:s("notifications_declined_title","Notifications declined")}),(0,t.jsx)("div",{className:"text-xs text-secondary",children:s("notifications_change_anytime","You can change this anytime in settings.")})]}),(0,t.jsx)(aS.X,{className:"size-5"})]}):"ALLOWED"===i?(0,t.jsxs)("div",{className:"flex items-center gap-4 min-w-[348px]",children:[(0,t.jsx)(aG.Check,{className:"size-5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-semibold",children:s("notifications_enabled_title","Notifications enabled")}),(0,t.jsx)("div",{className:"text-xs text-secondary",children:s("notifications_enabled_subtitle","We'll keep you updated")})]})]}):(0,t.jsxs)("div",{className:"flex justify-between items-center gap-4 relative group min-w-[360px]",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(aH,{className:"size-5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-semibold",children:s("notifications_ask_title","Get notified when Grok finishes answering")}),(0,t.jsx)("div",{className:"text-xs text-secondary",children:s("notifications_ask_subtitle","Enable notifications")})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 -me-2",children:[(0,t.jsx)(h.Button,{className:"rounded-xl px-2 py-2",variant:"secondary",disabled:"WAIT"===i,onClick:o,children:s("notifications_enable","Enable")}),(0,t.jsx)(h.Button,{variant:"textSecondary",size:"iconXs","aria-label":s("notifications-toast-dismiss","Dismiss"),onClick:()=>a(!0),children:(0,t.jsx)(aS.X,{className:"!size-4"})})]})]})};var aW=e.i(164877);function aV(e){let{conversationId:a,lastMessageId:s}=e,{t:i}=(0,w.useTranslation)("chat"),n=(0,r.useChatPageStore)(U.prop("requestShareDialogOpen")),o=(0,r.useChatPageStore)(U.prop("setRequestShareDialogOpen")),l=(0,W.useMobileSize)(),d=(0,A.useLogEvent)(),u=(0,S.useCallback)(e=>{o(e)},[o]);(0,S.useEffect)(()=>{n&&d("request_share_dialog_opened",void 0,{location:"request-share-dialog"})},[d,n]);let m=(0,S.useCallback)(()=>{o(!1)},[o]),p=(0,S.useCallback)(()=>{d("request_share_dialog_share_pressed",void 0,{location:"request-share-dialog"}),F.toast.success(i("share-request-dialog.share-success","Conversation shared!")),o(!1)},[o,d,i]),g=(0,S.useCallback)(()=>(0,t.jsxs)("div",{className:"space-y-4 py-2",children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)("div",{className:"h-1.5 w-1.5 rounded-full mt-2 flex-shrink-0 bg-primary"}),(0,t.jsx)("p",{className:"text-sm",children:i("share-request-dialog.viewers-can-only-see-current-messages","Viewers will be only able to see current messages at time of sharing.")})]}),(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)("div",{className:"h-1.5 w-1.5 rounded-full mt-2 flex-shrink-0 bg-primary"}),(0,t.jsx)("p",{className:"text-sm",children:i("share-request-dialog.viewers-cannot-add-or-modify","Viewers will not be able to add or modify this conversation.")})]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-2 p-3 border rounded-md",children:[(0,t.jsx)(aW.AlertTriangle,{className:"h-4 w-4 text-secondary mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"text-sm text-secondary font-semibold",children:[i("share-request-dialog.note","Note"),":"]}),(0,t.jsx)("p",{className:"text-sm italic text-secondary",children:i("share-request-dialog.sharing-this-conversation-means-anybody-with-the-share-link-will-be-able-to-view-it","Sharing this conversation means anybody with the share link will be able to view it.")})]})]}),(0,t.jsxs)("div",{className:"w-full flex items-center gap-2 justify-end",children:[(0,t.jsx)(eF.Button,{variant:"secondary",size:"md",shape:"rectangle",onClick:m,children:i("share-request-dialog.cancel","Cancel")}),a&&s&&(0,t.jsx)(c.ShareButton,{variant:"primary",size:"md",conversationId:a,responseId:s,iconProps:{size:18,strokeWidth:2},showLabel:!0,className:"rounded-xl",onClick:p})]})]}),[a,m,p,s,i]);return l?(0,t.jsx)(Q.Drawer,{open:n,onOpenChange:u,children:(0,t.jsxs)(Q.DrawerContent,{className:"focus:outline-none bg-surface-l1 pt-1 p-6 h-[80dvh] mb-2",children:[(0,t.jsx)("div",{className:"text-lg font-semibold",children:i("share-request-dialog.title","Share request")}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground mb-4",children:i("share-request-dialog.description","Someone would like access to a shared version of this conversation.")}),g()]})}):(0,t.jsx)(eo.Dialog,{open:n,onOpenChange:u,children:(0,t.jsxs)(eo.DialogContent,{className:"sm:max-w-md rounded-3xl border border-border-l1 p-6",children:[(0,t.jsxs)(eo.DialogHeader,{children:[(0,t.jsx)(eo.DialogTitle,{className:"text-lg font-semibold",children:i("share-request-dialog.title","Share request")}),(0,t.jsx)(eo.DialogDescription,{className:"text-sm text-muted-foreground",children:i("share-request-dialog.description","Someone would like access to a shared version of this conversation.")})]}),g()]})})}function aY(){let{user:e}=(0,eu.useSession)(),n=(0,r.useChatPageStore)(U.prop("optimisticConversationId")),o=(0,r.useChatPageStore)(U.prop("conversationId")),l=(0,r.useChatPageStore)(U.prop("lastMessageId")),c=(0,ev.useConversationStore)(U.prop("fetchGetConversation")),d=(0,ey.useSearchParams)(),u=(0,ey.useRouter)(),m=(0,ey.usePathname)(),{route:p}=(0,ef.useRouting)();(0,S.useEffect)(()=>{var e;if("chat"===p.page&&p.temporary)return;let t="chat"===p.page&&null!=(e=p.conversationId)?e:void 0;r.useChatPageStore.setState({conversationId:t})},[p]);let g=(0,r.useChatPageStore)(U.prop("setRequestShareDialogOpen"));(0,S.useEffect)(()=>{let e="SHARE_REQUESTED";if("true"===d.get(e)){g(!0);let t=new URLSearchParams(d.toString());t.delete(e),u.replace("".concat(m,"?").concat(t.toString()),{scroll:!1})}},[m,u,d,g]),(()=>{let{t:e}=(0,w.useTranslation)("base"),[a,s]=(0,S.useState)(""),i=(0,r.useChatPageStore)(e=>e.lastMessageId),n=(0,r.useChatPageStore)(e=>e.streamedMessageId),o=(0,O.useResponseStore)(e=>e.byId),l=o[i||""],c=o[n||""],d=(0,S.useMemo)(()=>{let e=l;for(;e&&"human"!==e.sender;)e=e.parentResponseId?o[e.parentResponseId]:void 0;return null==e?void 0:e.message},[l,o]),[u,m]=(0,D.useLocalStorage)("notifications-toast-dismiss-count",0),[p,g]=(0,S.useState)(0),h=(0,S.useRef)(new Set),x=(0,B.useSettingsStore)(e=>e.userSettings.preferences.browserNotificationsEnabled),f=(0,S.useCallback)(()=>{var t,a;if(null==(t=document)?void 0:t.hasFocus())return;let s=null==l||null==(a=l.uiLayout)?void 0:a.reasoningUiLayout;if("HEAVY"!==s&&"UNIFIED"!==s)return;let i="HEAVY"===s?e("notifications-heavy-answer-ready","Grok Heavy answer is ready"):e("notifications-answer-ready","Grok answer is ready"),n=window.matchMedia("(prefers-color-scheme: dark)").matches?"/images/notification-icon-dark.png":"/images/notification-icon-light.png";new Notification(i,d?{body:e("notifications-check-results-with-message",'Check results for "{{userMessage}}"',{userMessage:d}),icon:n}:{icon:n}).onclick=()=>{window.focus()}},[l,d,e]),v=(0,S.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];F.toast.dismiss(a),s(""),e&&m(e=>e+1)},[m,a]),y=!!(null==c?void 0:c.liveThinkingStartTime)||!!(null==c?void 0:c.thinkingStartTime)||!!(null==c?void 0:c.searchingStartTime)||(null==c?void 0:c.steps)&&c.steps.length>0;return(0,S.useEffect)(()=>{if(!x&&c&&y){if((null==c?void 0:c.state)==="streaming")return void g(1e3);(null==l?void 0:l.state)==="closed"&&g(0)}},[c,l,x,y]),(0,S.useEffect)(()=>{if(0===p||x)return;let e=setTimeout(()=>g(e=>e+1e3),1e3);return()=>clearTimeout(e)},[x,p]),(0,S.useEffect)(()=>{let e=p>=3e3&&p<=4e3;!a&&!x&&e&&u<1&&1&&s((0,F.toast)((0,t.jsx)(aq,{onDismiss:v}),{duration:1/0,className:"inset-x-0 mx-auto"}))},[u,v,p,a]),(0,S.useEffect)(()=>{(null==l?void 0:l.liveThinkingStartTime)&&(null==l?void 0:l.state)==="closed"&&(x&&i&&!h.current.has(i)&&(f(),h.current.add(i)),a&&(l.partial?v(!1):setTimeout(()=>v(!1),2e3)))},[x,v,l,f,a,i])})(),function(){let e=(0,ey.useSearchParams)(),{t}=(0,w.useTranslation)("chat"),a=(0,ey.useRouter)(),s=(0,S.useRef)(!1),i=e.get(em.CONNECT_OAUTH_PROVIDER_SEARCH_PARAM),n=(0,ex.usePrettyOauthProvider)(i||"");(0,S.useEffect)(()=>{if(!s.current&&i){setTimeout(()=>F.toast.success(t("oauth.connection.success","Successfully connected {{provider}}!",{provider:n})),0),s.current=!0;let e=new URL(window.location.href);e.searchParams.delete(em.CONNECT_OAUTH_PROVIDER_SEARCH_PARAM),a.replace("".concat(e.pathname).concat(e.search).concat(e.hash,"/"),{scroll:!1})}},[n,i,a,t])}(),function(e){let t=(0,ev.useConversationStore)(t=>e?t.byId[e]:void 0);(0,eg.useDocumentTitle)(null==t?void 0:t.title)}(o),function(){let e=(0,r.useChatPageStore)(U.prop("conversationMode")),t=(0,r.useChatPageStore)(U.prop("voiceConnectionStatus")),a=(0,r.useChatPageStore)(U.prop("exitVoiceMode")),s=(0,R.useImageEditorStore)(U.prop("isOpen")),{user:i}=(0,eu.useSession)(),n=(0,P.useFeatureFlags)(),o=(0,es.useRequestErrorToastFn)(),{route:l,replace:c}=(0,ef.useRouting)(),{signInWithReturnTo:d}=(0,ep.useGrokRouter)(),{handleVoiceModeEnter:u}=(0,eD.useVoiceMode)({location:"voice-chat-page"});(0,S.useEffect)(()=>{if("voice"in l&&l.voice&&"voice"!==e&&(c({page:"main",voice:!1}),n.ENABLE_VOICE_MODE))if(i)u().catch(e=>(0,y.logError)("chat-page:handleVoiceModeEnter",e));else{(0,y.logEventGlobal)("sign_in","voice-chat-page",{location:"voice-chat-page"}),d(void 0,void 0,!0);return}},[l,c,e,u,t,i,d,n]),(0,S.useEffect)(()=>{s&&"voice"===e&&a("navigation").catch(e=>{o("chat-page:exitVoiceMode",e)})},[s,e,a,o])}(),function(){let e=(0,eC.useIsActiveGrokBusinessSession)(),t=(0,P.useFeatureFlags)(),{route:a}=(0,ef.useRouting)(),s="optimistic_template_conversation";(0,S.useEffect)(()=>{let i=r.useChatPageStore.getState();if(e&&"main"===a.page&&a.templateId&&t.ENABLE_TEMPLATES&&!i.optimisticConversationId){i.setOptimisticConversationId(void 0),i.setOptimisticMessageId(void 0),i.setConversationId(void 0),i.setSidePanelContent(void 0);let e={...(0,ev.createOptimisticConversation)({conversationId:s,temporary:!0})},t=ev.useConversationStore.getState();t.upsertAndCacheConversation(e),i.setOptimisticConversationId(e.conversationId);let a=new AbortController;t.idsertAbortControllerById(a,e.conversationId)}if("main"===a.page&&!a.templateId&&i.optimisticConversationId&&i.optimisticConversationId===s){let e=ev.useConversationStore.getState();e.removeConversation(s),e.removeAbortControllerById(i.optimisticConversationId),i.setOptimisticConversationId(void 0)}},[e,t.ENABLE_TEMPLATES,a])}();let{data:h,isLoading:x,error:f}=(0,eh.usePromise)(o?c(o):void 0),{data:{enableFileUploads:v}={}}=(0,aD.useFeatureControls)();(0,S.useEffect)(()=>{r.useChatPageStore.getState().setChatPageLoaded(!0)},[]);let b=(0,r.useChatPageStore)(U.prop("setQuotePopupData"));(0,S.useEffect)(()=>{let e=e=>{let t=window.getSelection();t&&0!==t.rangeCount&&0!==t.toString().trim().length||b(void 0)},t=e=>{let t=window.getSelection();t&&0!==t.rangeCount&&0!==t.toString().trim().length||b(void 0)};return document.addEventListener("click",e),document.addEventListener("selectionchange",t),()=>{document.removeEventListener("click",e),document.removeEventListener("selectionchange",t)}},[b]);let j=(0,S.useRef)(null),I=(0,S.useMemo)(()=>"main"===p.page&&p.templateId||void 0,[p]);return(0,t.jsx)(i.ErrorBoundary,{fallbackRender:()=>(0,t.jsx)(aK,{}),children:(0,t.jsxs)("main",{ref:j,className:(0,N.cn)("h-dvh flex-grow flex-shrink relative selection:bg-highlight w-0","@container isolate","print:h-full print:prose print:max-w-none"),children:[o&&l&&(0,t.jsx)(aV,{conversationId:o,lastMessageId:l}),(0,t.jsx)(s.TriggeredError,{hidden:!0}),v&&(0,t.jsx)(aF,{conversationId:o,containerRef:j,user:e}),(0,t.jsx)(t_.ChatTopNav,{conversationIsLoading:x,conversation:h||void 0,isOptimisticConversation:!!n}),(0,t.jsx)(a.CommandMenu,{}),n&&"main"===p.page||o&&"chat"===p.page?(0,t.jsx)(aR,{optimisticConversationId:n,conversationIsLoading:x,conversationError:f,conversationId:o,conversation:h,templateId:I},"conversation-view"):(0,t.jsx)(aA,{}),(0,t.jsx)(ed,{})]},"chat-page")})}function aK(){let{t:e}=(0,w.useTranslation)("chat");return(0,t.jsx)("div",{className:"w-full h-dvh flex justify-center items-center align-middle",children:(0,t.jsxs)("div",{className:"w-full max-w-lg text-center",children:[(0,t.jsx)(ef.Link,{route:{page:"main"},className:"mb-6 flex justify-center",children:(0,t.jsx)(n.GrokWordLogo,{height:20,width:60,className:"opacity-80 hover:opacity-100 fill-black dark:fill-white"})}),(0,t.jsx)("div",{children:e("There was an error","There was an error")}),(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsx)(h.Button,{variant:"primary",size:"md",onClick:()=>{window.location.href="/"},children:e("Return to Home","Return to Home")})})]})})}}]);
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="9058fb39-22fd-5fe4-a937-74952be6f600")}catch(e){}}();
//# debugId=9058fb39-22fd-5fe4-a937-74952be6f600
